<!DOCTYPE html>
<html>
<head>
    <title>014 Spline Smoothhing</title>

    <style type="text/css">

    body {
        margin: 0;
        font-family: monospace;
        background-color: #222;
        overflow: hidden;
    }

    canvas {
        background-color: #000;
    }

    </style>


</head>
<body>

<canvas></canvas>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../src/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/SquarerootGL.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Cube.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Cylinder.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Geometry.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Icosphere.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Mesh.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Pyramid.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Quad.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Sprite2D.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Sprite3D.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Tube.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Mathx.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Noise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/PerlinNoise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/sqr/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spline.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spring.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/sqr/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Point.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/WebGL.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Color.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Cubemap.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/FrameBuffer.js"></script>
<script type="text/javascript" src="../../src/sqr/util/GL.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Loader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/OBJParser.js"></script>
<script type="text/javascript" src="../../src/sqr/util/PostEffect.js"></script>
<script type="text/javascript" src="../../src/sqr/util/RenderRegion.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Shader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Texture.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

<script type="text/javascript">

var canvas = document.querySelector('canvas');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
var ctx = canvas.getContext('2d');

var drawPoints = function() {
    var r = points.length;

    ctx.strokeStyle = '#f00';
    ctx.beginPath();

    for(var i = 0; i < r; i++) {
        var t = points[i];
        if(i == 0) ctx.moveTo(t.x, t.y);
        ctx.lineTo(t.x, t.y);
    }

    ctx.stroke();
}

var createSpline = function(drawControlPoints) {

    var ps = [], l = points.length;

    for(var i = 0; i < l; i += 6) {
        ps.push(points[i]);
    }

    if(ps.length < 4) return;
    if(ps.length % 2 == 1) ps.push(ps[ps.length-1]);

    var spline = new SQR.Spline(ps[0], ps[1], ps[2], ps[3]);

    for(var i = 4; i < ps.length; i += 2) {
        spline.add(ps[i], ps[i+1]);
    }

    return drawSpline(spline, drawControlPoints);
}

var drawSpline = function(spline, drawControlPoints) {

    var r = 200;

    ctx.strokeStyle = 'rgba(255, 255, 255, 0.75)';
    ctx.beginPath();

    for(var i = 0; i <= r; i++) {
        var t = spline.valueAt(i/r);
        if(i == 0) ctx.moveTo(t.x, t.y);
        ctx.lineTo(t.x, t.y);
    }

    ctx.stroke();

    if(drawControlPoints) {
        for(var i = 0; i < spline.controlPoints.length; i++) {
            var p = spline.controlPoints[i];
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    return spline;
}

var drawing = false, lastPoint = new SQR.V2(), points = [], splines = [];

document.addEventListener('mousedown', function(e) {
    drawing = true;
    points = [];
    mp.set(e.pageX, e.pageY);
});

var mp = new SQR.V2();

document.addEventListener('mousemove', function(e) {
    if(drawing) {
        mp.set(e.pageX, e.pageY);
        draw();
    }
});

document.addEventListener('mouseup', function() {
    drawing = false;
    var s = draw();
    if(s) splines.push(s);
});

var draw = function() {
    // requestAnimFrame(draw);

    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    points.push(mp.clone());

    for(var i = 0; i < splines.length; i++) {
        drawSpline(splines[i]);
    }

    if(drawing) drawPoints();
    return createSpline(drawing);
}

// draw();

</script>

<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>

</body>
</html>




















