<!DOCTYPE html>
<html>
<head>
    <title>SquareRoot | v0.15</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <style type="text/css">

        body {
            overflow: hidden;
        }

        #canvas {
            position: absolute;
            top: 0px;
            left: 0px;
        }

    </style>

    <script type="text/javascript" src="../lib/requestAnimFrame.js"></script>

<script type="text/javascript" src="../src/SQR.js"></script>

<script type="text/javascript" src="../src/engine/Engine.js"></script>
<script type="text/javascript" src="../src/engine/Transform.js"></script>
<script type="text/javascript" src="../src/engine/Geometry.js"></script>
<script type="text/javascript" src="../src/engine/renderers/DOMElement.js"></script>
<script type="text/javascript" src="../src/engine/renderers/Particle.js"></script>
<script type="text/javascript" src="../src/engine/renderers/Segment.js"></script>
<script type="text/javascript" src="../src/engine/objects/Particle2D.js"></script>

<script type="text/javascript" src="../src/math/Vector2.js"></script>
<script type="text/javascript" src="../src/math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../src/math/Matrix2D.js"></script>
<script type="text/javascript" src="../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../src/math/Quaternion.js"></script>
<script type="text/javascript" src="../src/math/MathUtil.js"></script>

<script type="text/javascript" src="../src/engine/util/Stringify.js"></script>
<script type="text/javascript" src="../src/engine/util/DOMUtil.js"></script>
<script type="text/javascript" src="../src/engine/util/Time.js"></script>
<script type="text/javascript" src="../src/engine/util/Color.js"></script>

    <script type="text/javascript">

        var engine;
        var distanceVector = new SQR.V2();
        var midScreen;
        var mx = 0, my = 0;

        window.onload = function() {

            engine = new SQR.Engine(document.getElementById('canvas'));
            engine.setBackground("#000000");
            engine.setSize(window.innerWidth, window.innerHeight);
            engine.setClearColor("rgba(0,0,0,0.025)");

            midScreen = new SQR.V2(window.innerWidth, window.innerHeight);

            var numParticles = (navigator.platform == "iPad") ? 100 : 500;

            for (var i = 0; i < numParticles; i++) {
                var r = 5;
                var h = (240 + Math.random() * 30) % 255;
                var s = 100;
                var l = 25 + Math.random() * 50;

                var p = new SQR.Particle2D(r, SQR.Color.hsl(h, s, l));
                p.angle = SQR.twoPI * Math.random();

                p.pathRadius = 120 + i * r * 0.12;
                p.secPathRadius = p.pathRadius * 0.6 + Math.random() * 0.3;

                var s = (Math.random() > 0.5) ? 1 : -1;
                p.speed = (0.3 + Math.random() * 0.5) / (p.pathRadius / 20) * s;

                engine.add(p);

                document.addEventListener('mousemove', function(e) {
                    mx = e.pageX;
                    my = e.pageY;
                }, null);
            }

            render();
        }

        var ticker = 0;

        function render() {

            requestAnimFrame(render);
            //if(ticker++ % 2 == 0) return;

            var w = window.innerWidth * 0.5;
            var h = window.innerHeight * 0.5;
            var p;

            for (var i = 0; i < engine.numChildren; i++) {
                p = engine.children[i];

                var sf = 1 + Math.sin(p.angle * p.pathRadius * 0.1) * 0.4;

                p.transform.setTranslation(w, h).
                        rotate(p.angle).
                        translate(p.pathRadius, 0).
                        scale(sf, sf).
                        rotate(p.angle * 12).
                        translate(p.pathRadius / 2, 0);


                p.transform.getTranslation(distanceVector);

                distanceVector.x -= window.innerWidth * 0.5;
                distanceVector.y -= window.innerHeight * 0.5;

                var s = distanceVector.magsq() / (512 * 512) * 100;
                s = Math.max(0, Math.min(s, 100));
                s = 100 - s;
                s = s / 2;

                if(p.color < s) p.color = s;
                p.color *= 0.999;

                p.fill = SQR.Color.hsl(s, 100, 25 + s);

                p.angle += p.speed * SQR.Time.deltaTime / 1000;
            }

            engine.render();
        }

    </script>

</head>
<body>
<div id="container">
    <canvas id="canvas"></canvas>
</div>
</body>
</html>