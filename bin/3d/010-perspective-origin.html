<!DOCTYPE html>
<html>
<head>
<title>Perspective Origin | v0.15</title>

<script type="text/javascript" src="../../lib/modernizr.custom.56278.js"></script>
<script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/color/Color.js"></script>
<script type="text/javascript" src="../../src/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/math/Mathx.js"></script>
<script type="text/javascript" src="../../src/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/math/Noise.js"></script>
<script type="text/javascript" src="../../src/math/PerlinNoise.js"></script>
<script type="text/javascript" src="../../src/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/math/Spline.js"></script>
<script type="text/javascript" src="../../src/math/Spring.js"></script>
<script type="text/javascript" src="../../src/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/Geometry.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Particle2D.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Quad.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

<style type="text/css">

    body {
        overflow: hidden;
        background-color: #000000;
        font-family: Georgia, sans-serif;
    }

    #canvas {
        position: absolute;
        top: 0px;
        left: 0px;
    }

    #div-container {
        position: absolute;
        top: 50%;
        left: 50%;
    }

    .plane {
        position: absolute;
        margin-top: -200px;
        margin-left: -200px;
        width: 400px;
        height: 400px;
        overflow: hidden;
    }

    .light {
        background-color: black;
        opacity: 0.7;
        position: absolute;
        width: 400px;
        height: 400px;
    }

    .text {
        position: absolute;
        padding: 20px;
        color: #ffffff;
        font-size: 14px;

    }

    .tcan {
        position: absolute;
    }

    .plane img {
        position: absolute;
        width: 400px;
        height: 400px;
    }

    #instr {
        position: absolute;
        top: 10px;
        left: 10px;
        font-family: Georgia, sans-serif;
        color: #ffffff;
        font-size: 14px;
    }

</style>

<script type="text/javascript">

    var container, engine, camera, div2d, div3d;
    var eo, z, origin = 0;
    var my = 0, mx = 0;

    function createDiv(imageUrl) {
        var ht = document.createElement('div');
        ht.setAttribute('class', 'plane');

        var hti = new Image();
        hti.src = imageUrl;
        ht.appendChild(hti);

        var lgt = document.createElement('div');
        lgt.setAttribute('class', 'light');
        ht.appendChild(lgt);

        for(var i = 0; i < 20; i++) {

            var cnv = document.createElement('canvas');
            cnv.setAttribute('class', 'tcan');

            cnv.style.top = 50 + (Math.random() * 300) + "px";
            cnv.style.left = 50 + (Math.random() * 300) + "px";

            cnv.width = 50;
            cnv.height = 50;
            var ctx = cnv.getContext('2d');
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(25, 25, 20, 0, SQR.twoPI);
            ctx.closePath();
            ctx.fill();

            ht.appendChild(cnv);
        }

        var txt = document.createElement('div');

        txt.innerHTML = "<h1>Header</h1><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque viverra elit nec mauris adipiscing vestibulum. Proin dictum, <a href='#nothing'>justo eget rhoncus sagittis</a>, turpis orci varius orci, sit amet porttitor purus tellus a enim.</p>";

        txt.setAttribute('class', 'text');
        ht.appendChild(txt);

        ht.addEventListener('click', function(e) {
            // Diz to handle mouse clicks
            console.log("Clicked!");
        });

        return ht;
    }

    window.onload = function() {
        SQR.supportsCss3d = Modernizr.csstransforms3d;
        console.log("Browser supports CSS 3D: " + SQR.supportsCss3d);

        container = document.getElementById("div-container");

        // Parameters are: canvas, container
        engine = new SQR.Squareroot(null, container);
        engine.setBackground("#000000");
        engine.setSize(window.innerWidth, window.innerHeight);
        engine.setProjection(30);

        camera = new SQR.Transform('camera');
        camera.position.z = engine.cssDistance();
        engine.add(camera);

        eo = 0;
        z = -100;
        for (var i = 0; i < 50; i++) {
            div3d = new SQR.Transform();
            div3d.positioningMode = SQR.DYNAMIC_TRANSFORM;

            if (SQR.supportsCss3d) div3d.renderer = new SQR.DOMElement3D(createDiv("../assets/square-400.jpg"));
            else div3d.renderer = new SQR.DOMElement2D(createDiv("../assets/square-400.jpg"));

            div3d.renderer.setBackfaceVisibility(false);
            div3d.position.z = z;

            if (!eo) {
                div3d.position.x = 320;
                div3d.rotation.y = 0.2;
                eo = 1;
            } else {
                div3d.position.x = -320;
                div3d.rotation.y = -0.2;
                eo = 0;

            }

            z -= 1000;

            engine.add(div3d);
        }

        document.addEventListener('mousemove', function(e) {
            mx = e.pageX / window.innerWidth;
            my = e.pageY / window.innerHeight;
        }, false);

        render();
    }

    var a = 1;

    var throttle = 0;

    function render() {
        requestAnimFrame(render);

        camera.position.z += -100 * SQR.Time.deltaTime;

        camera.rotation.y = (mx * 2 - 1) / -4;
        camera.rotation.x = (my * 2 - 1) / -4;

        engine.recurse(function(t) {
            if(t.name != 'camera') {
                t.rotation.y = (t.position.x > 0 ) ? my : -my;
            }
        });

        if (throttle++ % 2 == 0) engine.render(camera);
    }

</script>

</head>
<body>
<div id="canvas-container">
    <canvas id="canvas"></canvas>
</div>
<div id="div-container"></div>

<div id="instr">Perspective origin</div>

</body>
</html>