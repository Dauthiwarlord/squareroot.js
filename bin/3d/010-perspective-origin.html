<!DOCTYPE html>
<html>
<head>
    <title>Perspective Origin | v0.15</title>

    <script type="text/javascript" src="../../lib/modernizr.custom.56278.js"></script>
    <script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/color/Color.js"></script>
<script type="text/javascript" src="../../src/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/math/Spline.js"></script>
<script type="text/javascript" src="../../src/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/Geometry.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Particle2D.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/objects/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

    <style type="text/css">

        body {
            overflow: hidden;
            background-color: #000000;
        }

        #canvas {
            position: absolute;
            top: 0px;
            left: 0px;
        }

        #div-container {
            position: absolute;
            top: 50%;
            left: 50%;
        }

        .plane {
            position: absolute;
            margin-top: -200px;
            margin-left: -200px;
            width: 400px;
            height: 400px;
            overflow: hidden;
            background: red;
        }

        .plane img {
            position: absolute;
            width: 400px;
            height: 400px;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

    </style>

    <script type="text/javascript">

        var container, engine, camera, div2d, div3d;
		var eo, z, origin = 0;

        function createDiv(imageUrl) {
            var ht = document.createElement('div');
            ht.setAttribute('class', 'plane');

            var hti = new Image();
            hti.src = imageUrl;
            ht.appendChild(hti);
            
            return ht
        }

        window.onload = function() {
            SQR.supportsCss3d = Modernizr.csstransforms3d;
            console.log("Browser supports CSS 2D: " + SQR.supportsCss3d);

            container = document.getElementById("div-container");

            // Parameters are: canvas, container
            engine = new SQR.Squareroot(null, container);
            engine.setBackground("#000000");
            engine.setSize(window.innerWidth, window.innerHeight);
            engine.setProjection(30);

            camera = new SQR.Transform();
            camera.position.z = engine.cssDistance();
            engine.add(camera);

			eo = 0;
			z = -100;
			for (var i = 0; i < 100; i++) {
            	div3d = new SQR.Transform();

	            if(SQR.supportsCss3d) div3d.renderer = new SQR.DOMElement3D(createDiv("../assets/square-400.jpg"));
	            else div3d.renderer = new SQR.DOMElement2D(createDiv("../assets/square-400.jpg"));

	            div3d.renderer.setBackfaceVisibility(false);
	            div3d.position.z = z;
	
				if (!eo) {
					div3d.position.x = 220;
					div3d.rotation.y = 1.2;
					eo = 1;
				} else {
					div3d.position.x = -220;
					div3d.rotation.y = -1.2;
					eo = 0;
					z -= 1000;
				}
	            engine.add(div3d);
			}

            render();
        }

        var a = 1;

        function render() {
            requestAnimFrame(render);

			camera.position.z += -5;
			
			origin = Math.sin(a) * 100;
			engine.setPerspectiveOrigin(0, origin);

            a += 0.03;

            engine.render(camera);
        }

    </script>

</head>
<body>
<div id="canvas-container">
    <canvas id="canvas"></canvas>
</div>
<div id="div-container"></div>

<div id="instr">Perspective origin</div>

</body>
</html>