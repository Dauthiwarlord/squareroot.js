<!DOCTYPE html>
<html>
<head>
<title>Hexagon Menu | v0.10</title>

<script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../build/squareroot-min.js"></script>
<!-- SQRLIB -->

<style type="text/css">

    body {
        overflow: hidden;
    }

    #canvas {
        position: absolute;
        top: 0px;
        left: 0px;
    }

    #div-container {
        position: absolute;
        top: 50%;
        left: 50%;
    }

    #div-container div {
        position: absolute;
        top: 0px;
        left: 0px;
    }

    #div-container div canvas {
        position: absolute;

    }

    #div-container div span {
        position: absolute;
        width: 100%;
        text-align: center;
        display: block;
        font-family: Georgia;
        color: #ffffff;
    }

</style>

<script type="text/javascript">

    var s = 60;

    function drawHexagon(ctx, saturation, light, radius) {
        ctx.fillStyle = SQR.Color.hsl(0, saturation, light);
        ctx.strokeStyle = 'rgb(255,255,255)';
        ctx.lineWidth = 5;
        ctx.beginPath();

        var v = new SQR.V2();

        for (var i = 0; i <= 6; i++) {
            v.set(radius, radius).addAngleRadius(i / 3 * Math.PI, radius);
            if (i == 0) ctx.moveTo(v.x, v.y);
            else ctx.lineTo(v.x, v.y);
        }

        ctx.fill();
        ctx.stroke();
    }

    function createHexagonTexture(light, radius, title) {
        var hexagonCanvas = document.createElement('canvas');
        hexagonCanvas.width = hexagonCanvas.height = radius * 2;

        light = 10 + 40 * light;

        var ctx = hexagonCanvas.getContext('2d');
        drawHexagon(ctx, 0, light, radius);

        var hexagon = document.createElement('div');
        hexagon.style.width = radius * 2 + 'px';
        hexagon.style.height = radius * 2 + 'px';
        hexagon.style.marginTop = -radius + 'px';
        hexagon.style.marginLeft = -radius + 'px';
        hexagon.appendChild(hexagonCanvas);

        hexagon.addEventListener('mouseover', function() {
            drawHexagon(ctx, 100, 50, radius);
        }, false);

        hexagon.addEventListener('mouseout', function() {
            drawHexagon(ctx, 0, light, radius);
        }, false);

        if (title) {
            var titleNode = document.createElement('span');
            titleNode.style.marginTop = (radius-10) + 'px';
            titleNode.innerHTML = title;
            hexagon.appendChild(titleNode);
        }

        return hexagon;
    }

    var container, engine, camera, hairyBall, root;

    function addHexagon(root, x, y, z, r, title) {
        var v = new SQR.V3(x, y, z).norm().mul(r)
        var ht = createHexagonTexture(Math.random(), s, title);

        var t = new SQR.Transform();
        t.position.set(v.x, v.y, v.z);
        //t.lookAt(root);
        t.lookInDirection(v.neg());
        t.renderer = new SQR.DOMElement3D(ht);
        //t.renderer.setBackfaceVisibility();
        root.add(t);

        return t;
    }

    window.onload = function() {

        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, false);

        container = document.getElementById("div-container");

        engine = new SQR.Squareroot(document.getElementById('canvas'), container);
        engine.setBackground("#ffffff");
        engine.setSize(window.innerWidth, window.innerHeight);
        engine.setProjection(60);

        camera = new SQR.Transform();
        camera.position.z = 700;
        engine.add(camera);

        root = new SQR.Transform();
        engine.add(root);

        var r = (s * 16) / SQR.twoPI;

        var segmentsY = 4;

        var phiStart = 0;
        var phiLength = SQR.twoPI;
        var thetaStart = 0;
        var thetaLength = Math.PI;
        var x, y;

        for (y = 0; y <= segmentsY; y ++) {

            var segmentsX;
            var phiStart = 0;

            switch(y) {
                case 0:
                case 4:
                    segmentsX = 1;
                break;
                case 1:
                case 3:
                    segmentsX = 4;
                break;
                case 2:
                    segmentsX = 8;
                break;
            }

            for (x = 0; x < segmentsX; x ++) {

                var u = x / segmentsX;
                var v = y / segmentsY;

                var xp = -Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);
                var yp = Math.cos(thetaStart + v * thetaLength);
                var zp = Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);

                addHexagon(root, xp, yp, zp, r, '');
            }
        }

        render();
    }

    var a = 1;
    var throttle = 0;

    function render() {
        requestAnimFrame(render);

        if(throttle++ % 2 == 0) return;

        root.rotation.y += 0.01;
        root.rotation.x += 0.005;

//        camera.rotation.y = Math.sin(a) * 0.4;
        a += 0.03;

        engine.render(camera);
    }

</script>

</head>
<body>
<div id="canvas-container">
    <canvas id="canvas"></canvas>
</div>
<div id="div-container"></div>
</body>
</html>