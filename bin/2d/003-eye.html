<!DOCTYPE html>
<html>
<head>
    <title>Eye | v0.20</title>

    <style type="text/css">

        body {
            background-color: #000000;
            overflow: hidden;
        }

        #cnv {
            position: absolute;
            top: 0px;
            left: 0px;
            background-color: #000000;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

        a, a:visited, a:active {
            color: white;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

    </style>

    <script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

    <!-- SQRLIB -->
    <!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
    <script type="text/javascript" src="../../build/squareroot-min.js"></script>
    <!-- SQRLIB -->

    <script type="text/javascript" src="003-ring/PieSegment.js"></script>

    <script type="text/javascript">

        var cnv, ctx;

        /*
         1. Build black arc, 1 by 1 (make it 12 or more)
         2. Repaint them red
         3. Bump up randomly for 2 seconds
         4. It says INTERACT ME and a counter start
         5. Allow for interactive for 10 sec
         6. Retract the red, retract the white
         7. Wait 1 second, restart
         */
        var numSegment = 100;

        var segments = [];

        var mx = 0, my = 0;

        var mouseAngle = 0, moved = false;

        var MAXR = 230;

        window.onload = function() {

            cnv = document.getElementById('cnv');
            cnv.width = window.innerWidth;
            cnv.height = window.innerHeight;

            ctx = cnv.getContext('2d');

            var aw = Math.PI * 2 / numSegment;

            for (var i = 0; i < numSegment; i++) {
                p = new PieSegment();

                p.startAngle = aw * i;
                p.angularWidth = aw;

                p.startRadius = 70;

                p.margin = 1;
                p.maxRadius = MAXR - p.startRadius;
                p.bump = 0;
                p.targetBump = 0;
                p.friction = 0.98;

                p.center = new SQR.V2(window.innerWidth * 0.5, window.innerHeight * 0.5);
                p.color = 'white';
                p.phase = 0;
                p.speed = 0.1 + Math.random() * 0.1;

                segments.push(p);
            }

            document.addEventListener('mousemove', function(e) {
                mx = e.pageX - window.innerWidth * 0.5;
                my = e.pageY - window.innerHeight * 0.5;
                mouseAngle = Math.atan2(my, mx);
                if(mouseAngle < 0) mouseAngle = Math.PI + (Math.PI + mouseAngle);
                moved = true;
            }, false);

            document.addEventListener('touchmove', function(e) {
                e.preventDefault();
                mx = e.pageX - window.innerWidth * 0.5;
                my = e.pageY - window.innerHeight * 0.5;
                mouseAngle = Math.atan2(my, mx);
                if(mouseAngle < 0) mouseAngle = Math.PI + (Math.PI + mouseAngle);
                moved = true;
            }, false);

            draw();
        }

        var a = 0;
        var globalWave = 0;

        function draw() {
            requestAnimFrame(draw);

            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.clearRect(0, 0, cnv.width, cnv.height);

            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(cnv.width * 0.5, cnv.height * 0.5, MAXR + 12, 0, SQR.twoPI);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(cnv.width * 0.5, cnv.height * 0.5, MAXR + 2, 0, SQR.twoPI);
            ctx.fill();

            for (var i = 0; i < numSegment; i++) {
                var p = segments[i];

                if(moved && Math.abs(mouseAngle - (p.startAngle)) < p.angularWidth * 2) {
                    p.targetBump = 1;
                }

                p.bump += (p.targetBump - p.bump) * 0.05;

                p.targetBump *= p.friction;

                var dp = p.maxRadius * p.bump;
                var sp = (p.maxRadius - dp) * (1 - p.bump);
                var cp = Math.max(0, sp + dp * 0.5 * Math.sin(p.phase));

                p.endRadius = p.startRadius + cp;
                p.phase += p.speed;
                p.draw(ctx);
            }

            globalWave += 0.03;

            moved = false;
        }

    </script>

</head>
<body>
<div id="container">
    <canvas id="cnv"></canvas>
</div>

<div id="instr">Eye<br>Move mouse or finger.<br>Inspired by an <a href="http://25.media.tumblr.com/tumblr_mazru9T0dx1qc0s10o1_500.gif">animated GIF</a> by <a href=="http://patakk.tumblr.com/">Patakk</a></div>

</body>
</html>