<!DOCTYPE html>
<html>
<head>
    <title>A few bouncing balls | v0.1</title>

    <style type="text/css">

        body {
            background-color: #000000;
        }

        #cnv {
            position: absolute;
            top: 0px;
            left: 0px;
            background-color: #000000;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

    </style>

    <!-- SQRLIB -->
    <!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
    <script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>
    <script type="text/javascript" src="../../src/SQR.js"></script>
    <script type="text/javascript" src="../../src/color/Color.js"></script>
    <script type="text/javascript" src="../../src/math/Interpolation.js"></script>
    <script type="text/javascript" src="../../src/math/Mathx.js"></script>
    <script type="text/javascript" src="../../src/math/Matrix2D.js"></script>
    <script type="text/javascript" src="../../src/math/Matrix33.js"></script>
    <script type="text/javascript" src="../../src/math/Matrix44.js"></script>
    <script type="text/javascript" src="../../src/math/Noise.js"></script>
    <script type="text/javascript" src="../../src/math/PerlinNoise.js"></script>
    <script type="text/javascript" src="../../src/math/ProjectionMatrix.js"></script>
    <script type="text/javascript" src="../../src/math/QuadraticBezier.js"></script>
    <script type="text/javascript" src="../../src/math/Quaternion.js"></script>
    <script type="text/javascript" src="../../src/math/Spline.js"></script>
    <script type="text/javascript" src="../../src/math/Spring.js"></script>
    <script type="text/javascript" src="../../src/math/Vector2.js"></script>
    <script type="text/javascript" src="../../src/math/Vector3.js"></script>
    <script type="text/javascript" src="../../src/math/VectorUtil.js"></script>
    <script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
    <script type="text/javascript" src="../../src/sqr/Transform.js"></script>
    <script type="text/javascript" src="../../src/sqr/geometry/Geometry.js"></script>
    <script type="text/javascript" src="../../src/sqr/geometry/Plane.js"></script>
    <script type="text/javascript" src="../../src/sqr/geometry/Quad.js"></script>
    <script type="text/javascript" src="../../src/sqr/geometry/Triangle.js"></script>
    <script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
    <script type="text/javascript" src="../../src/sqr/physics/Particle.js"></script>
    <script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
    <script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
    <script type="text/javascript" src="../../src/sqr/renderers/Point.js"></script>
    <script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
    <script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
    <script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
    <script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
    <script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
    <script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
    <script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
    <!-- SQRLIB -->

    <script type="text/javascript">

        var ctx;

        var gravity = new SQR.V2(0, 9.81), gravityScaled = new SQR.V2();

        var balls = [];
        var numBalls = 50;
        var gravityOn = true;

        window.onload = function() {

            var cnv = document.getElementById('cnv');

            ctx = cnv.getContext('2d');

            document.addEventListener('click', function(e) {

                for (var i = 0; i < balls.length; i++) {
                    var fx = Math.random() * 16000 - 8000;
                    var fy = -8000;
                    balls[i].addForce(new SQR.V2(fx, fy));
                }

            }, false);

            document.addEventListener('keydown', function(e) {
                if (e.keyCode == 32) gravityOn = !gravityOn;
            }, false);

            SQR.Particle.prototype.draw = function(ctx) {

                if (this.position.x + this.radius > window.innerWidth) {
                    this.position.x = window.innerWidth - this.radius;
                    this.velocity.x *= -this.bounciness;
                }

                if (this.position.x - this.radius < 0) {
                    this.position.x = this.radius;
                    this.velocity.x *= -this.bounciness;
                }

                if (this.position.y + this.radius > window.innerHeight) {
                    this.position.y = window.innerHeight - this.radius;
                    this.velocity.y *= -this.bounciness;
                }

                if (this.position.y - this.radius < 0) {
                    this.position.y = this.radius;
                    this.velocity.y *= -this.bounciness;
                }


                ctx.fillStyle = 'rgb(255,0,0)';
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, SQR.twoPI);
                ctx.fill();
            }

            cnv.width = window.innerWidth;
            cnv.height = window.innerHeight;

            for (var i = 0; i < numBalls; i++) {

                var r = Math.random();

                var b = new SQR.Particle(new SQR.V2(window.innerWidth * Math.random(), 20));
                b.radius = (1 + r) * 5;
                b.mass = (1 + r) * 5;
                b.bounciness = 0.8 - r * 0.7;
                b.frictionAir = 1;
                b.frictionGround = 20;
                b.addForce(new SQR.V2(Math.random() * 20 - 10, 0));
                balls.push(b);
            }

            draw();

        }

        function draw() {
            requestAnimFrame(draw);

            SQR.Time.tick();

            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

            for (var i = 0; i < balls.length; i++) {

                var b = balls[i];

                b.friction = (b.position >= window.innerHeight - b.radius - 0.1) ? b.frictionAir : b.frictionGround;

                if (gravityOn) {
                    gravityScaled.copyFrom(gravity).mul(b.mass);
                    b.addForce(gravityScaled);
                }

                b.update(SQR.Time.deltaTime);
                b.draw(ctx);
            }
        }

    </script>

</head>
<body>
<div id="container">
    <canvas id="cnv"></canvas>
</div>

<div id="instr">Click to push the balls, SPACE to toggle gravity</div>

</body>
</html>

















