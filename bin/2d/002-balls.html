<!DOCTYPE html>
<html>
<head>
    <title>A few bouncing balls | v0.1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable = no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <style type="text/css">

        body {
            background-color: #000000;
            overflow: hidden;
        }

        #cnv {
            position: absolute;
            top: 0px;
            left: 0px;
            background-color: #000000;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

    </style>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../build/squareroot-min.js"></script>
<!-- SQRLIB -->

    <script type="text/javascript">

        var ctx;

        var gravity = new SQR.V2(0, 9.81), gravityScaled = new SQR.V2();

        var balls = [];
        var numBalls = 30;
        var gravityOn = true;

        window.onload = function() {

            var cnv = document.getElementById('cnv');

            ctx = cnv.getContext('2d');

            document.addEventListener('click', function(e) {

                for (var i = 0; i < balls.length; i++) {
                    var fx = Math.random() * 16000 - 8000;
                    var fy = -8000;
                    balls[i].addForce(new SQR.V2(fx, fy));
                }

            }, false);

            document.addEventListener('touchstart', function(e) {

                for (var i = 0; i < balls.length; i++) {
                    var fx = Math.random() * 10000 - 5000;
                    var fy = -5000;
                    balls[i].addForce(new SQR.V2(fx, fy));
                }

            }, false);

            document.addEventListener('keydown', function(e) {
                if (e.keyCode == 32) gravityOn = !gravityOn;
            }, false);

            SQR.Particle.prototype.draw = function(ctx) {

                if (this.position.x + this.radius > window.innerWidth) {
                    this.position.x = window.innerWidth - this.radius;
                    this.velocity.x *= -this.bounciness;
                }

                if (this.position.x - this.radius < 0) {
                    this.position.x = this.radius;
                    this.velocity.x *= -this.bounciness;
                }

                if (this.position.y + this.radius > window.innerHeight) {
                    this.position.y = window.innerHeight - this.radius;
                    this.velocity.y *= -this.bounciness;
                }

                if (this.position.y - this.radius < 0) {
                    this.position.y = this.radius;
                    this.velocity.y *= -this.bounciness;
                }


                ctx.strokeStyle = 'rgba(255,0,0, 0.5)';
                ctx.lineWidth = 4;
                ctx.fillStyle = 'rgba(255,0,0, 0.5)';
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, SQR.twoPI);
                ctx.stroke();
                ctx.fill();
            }

            cnv.width = window.innerWidth;
            cnv.height = window.innerHeight;

            for (var i = 0; i < numBalls; i++) {

                var r = Math.random();

                var b = new SQR.Particle(new SQR.V2(window.innerWidth * Math.random(), 20));
                b.radius = (1 + r) * 6;
                b.mass = (1 + r) * 5;
                b.bounciness = 0.8 - r * 0.7;
                b.frictionAir = 1;
                b.frictionGround = 20;
                b.addForce(new SQR.V2(Math.random() * 20 - 10, 0));
                balls.push(b);
            }

            draw();

        }

        var throttle = 0;

        function draw() {
            requestAnimFrame(draw);

            var isOdd = (++throttle % 2 == 1);

            //if(isOdd) return;

            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            SQR.Time.tick();

            for (var i = 0; i < balls.length; i++) {

                var b = balls[i];

                b.friction = (b.position >= window.innerHeight - b.radius - 0.1) ? b.frictionAir : b.frictionGround;

                if (gravityOn) {
                    gravityScaled.copyFrom(gravity).mul(b.mass);
                    b.addForce(gravityScaled);
                }

                b.update(SQR.Time.deltaTime);
                b.draw(ctx);
            }
        }

    </script>

</head>
<body>
<div id="container">
    <canvas id="cnv"></canvas>
</div>
</body>
</html>

















