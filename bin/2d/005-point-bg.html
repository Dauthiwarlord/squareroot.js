<!DOCTYPE html>
<html>
<head>
    <title>Point Carpet 1 | v0.1</title>

    <!-- SQRLIB -->
    <!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
    <script type="text/javascript" src="../../build/squareroot-min.js"></script>
    <!-- SQRLIB -->

    <style type="text/css">

        body {
            overflow: hidden;
        }

        #cnv {
            position: fixed;
            top: 0px;
            left: 0px;
        }

    </style>

    <script type="text/javascript">

        var margin = 5;
        var spacing = 10;
        var color = 'rgb(190, 190, 190)';

        var ctx;

        var mx = 0, my = 0;
        var tmx = 0, tmy = 0;

        var strength = 1;
        var bounce = 0;
        var bounceForce = 0;
        var radius = 300;

        window.onload = function() {

            var cnv = document.getElementById('cnv');
            cnv.width = window.innerWidth;
            cnv.height = window.innerHeight;

            ctx = cnv.getContext('2d');

            document.addEventListener('mousemove', function(e) {
                tmx = e.pageX;
                tmy = e.pageY;
            }, false);

            document.addEventListener('click', function(e) {
                bounceForce = 1;
                bounce = 0;
            }, false);

            draw();
        }

        function draw() {
            requestAnimFrame(draw);

            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

            ctx.fillStyle = color;
            ctx.strokeStyle = color;
            ctx.beginPath();

            mx += (tmx - mx) * 0.1;
            my += (tmy - my) * 0.1;

            bounce += 0.2;
            bounceForce *= 0.98;

            for (var i = margin; i < window.innerWidth; i += spacing) {
                for (var j = margin; j < window.innerHeight; j += spacing) {

                    var di = i - mx;
                    var dj = j - my;

                    var m = Math.sqrt(di * di + dj * dj);

                    var r = radius;

                    if (r > 0) {
                        m = Math.min(r, m);
                        m = Math.pow(1 - m / r, 3);
                    } else {
                        m = 0;
                    }

                    var pi = i + di * m * (strength + Math.sin(bounce) * bounceForce);
                    var pj = j + dj * m * (strength + Math.sin(bounce) * bounceForce);

//                    ctx.fillRect(pi, pj, 2, 2);

                    ctx.moveTo(pi - 3, pj);
                    ctx.lineTo(pi + 3, pj);
                    ctx.moveTo(pi, pj - 3);
                    ctx.lineTo(pi, pj + 3);
                }
            }

            ctx.stroke();
        }

    </script>

</head>
<body>
<canvas id="cnv"></canvas>
</body>
</html>