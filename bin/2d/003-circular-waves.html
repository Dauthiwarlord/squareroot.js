<!DOCTYPE html>
<html>
<head>
<title>A few bouncing balls | v0.34</title>

<style type="text/css">

    body {
        background-color: #000000;
    }

    #cnv {
        position: absolute;
        top: 0px;
        left: 0px;
        background-color: #000000;
        /*display: none;*/
        z-index: -100;
    }

    #cnv2 {
        position: absolute;
        top: 0px;
        left: 0px;
        background-color: #000000;
        display: none;
    }

    #instr {
        position: absolute;
        top: 10px;
        left: 10px;
        font-family: Georgia, sans-serif;
        color: #ffffff;
        font-size: 14px;
    }

    #images {
        position: absolute;
        top: 50%;
        left: 50%;
        z-index: 100;
    }

    #images img, #images div {
        position: absolute;
        -webkit-backface-visibility: visible;
    }

    #images div {
    }

    #tl img {
        margin-top: -336px;
        margin-left: -336px;
    }

    #tr img {
        margin-top: -336px;
        margin-left: 30px;
    }

    #bl img {
        margin-top: 30px;
        margin-left: -336px;
    }

    #br img {
        margin-top: 30px;
        margin-left: 30px;
    }

</style>

<script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../build/squareroot-min.js"></script>
<!-- SQRLIB -->

<script type="text/javascript">

var ctx, ctx2;
var cnv, cnv2;
var particles = [];
var numParticles = 40;


var img1, img2, img3, img4;

var img1scale = 0;
var img2scale = 0;
var img3scale = 0;
var img4scale = 0;

var imgsRotation = 0;

window.onload = function() {

    cnv = document.getElementById('cnv');
    cnv2 = document.getElementById('cnv2');

    cnv.width = window.innerWidth;
    cnv.height = window.innerWidth;

    cnv2.width = window.innerWidth;
    cnv2.height = window.innerWidth;

    img1 = document.getElementById('tl');
    img2 = document.getElementById('tr');
    img3 = document.getElementById('bl');
    img4 = document.getElementById('br');

    cnv2.style.top = ((window.innerWidth - window.innerHeight) * -0.5) + 'px';

    ctx = cnv.getContext('2d');
    ctx2 = cnv2.getContext('2d');


    function beat() {
        electricEffect = 1;

        globalScale = 0.2;

        for (var i = 0; i < numParticles; i++) {
            var p = particles[i];
            var e = window.innerWidth * 0.5 * Math.random();
            if (e < 300) {
                p.extTarget = e;
                p.angle += 0.2;
            }
        }

        img1scale = (Math.random() > 0.4) ? 0.1 : img1scale;
        img2scale = (Math.random() > 0.4) ? 0.1 : img2scale;
        img3scale = (Math.random() > 0.4) ? 0.1 : img3scale;
        img4scale = (Math.random() > 0.4) ? 0.1 : img4scale;
    }

    var c = 0;
    var electricEffect = 0;

    function repeatBeat() {
        beat();
        c++;
        var next = 600;
        if (c % 4 == 0) next = 200;
        setTimeout(repeatBeat, next);
    }

    document.addEventListener('click', beat, false);

    SQR.Particle.prototype.draw = function(ctx) {

        var doDraw = true;

        if (!this.lastPosition) {
            this.lastPosition = this.position.clone();
            doDraw = false;
        } else {
            this.lastPosition.copyFrom(this.position);
        }


        this.angle += (this.extTarget > 20) ? this.angularVelocity * 0 : this.angularVelocity;

        var er = 0;

        this.extTarget *= this.friction;

        this.extRadius += (this.extTarget - this.extRadius) * 0.4;

        this.position.x = Math.cos(this.angle) * (this.radius + this.extRadius + er);
        this.position.y = Math.sin(this.angle) * (this.radius + this.extRadius + er);

        this.position.appendVec(this.origin);

        p.hue += 0.01;

        if (!doDraw) return;

        var a = (this.extRadius > 1) ? 1 : this.extRadius;

        ctx.globalAlpha = 0.2;

        ctx.strokeStyle = SQR.Color.hsl(p.hue, 100, 50);

        ctx.lineWidth = 6 + this.lineWidth * 5;
        ctx.lineCap = 'butt';
        ctx.beginPath();
        ctx.moveTo(this.lastPosition.x, this.lastPosition.y);
        ctx.lineTo(this.position.x, this.position.y);
        ctx.stroke();
    }

    for (var i = 0; i < numParticles; i++) {
        var p = new SQR.Particle(new SQR.V2());

        p.radius = 200 + Math.random() * 20;
        p.angle = Math.PI * 2 * Math.random();

        p.angularVelocity = 0.04 + Math.random() * 0.01;
        if (i % 2 == 0) p.angularVelocity *= -1;

        p.friction = 0.99;

        p.extRadius = 0;
        p.extTarget = 0;

        p.hue = 0;
        p.lineWidth = Math.random();

        p.origin = new SQR.V2(window.innerWidth * 0.5, window.innerWidth * 0.5);

        particles.push(p);
    }

    repeatBeat();
    draw();
}

function noe(n) {
    return Math.abs(n) < 0.000001 ? 0 : n;
}

var globalScale = 0;
var globalRotation = 0;

function draw() {
    requestAnimFrame(draw);

    SQR.Time.tick();


    ctx.fillStyle = 'rgba(0,0,0,0.3)';
//            ctx.fillStyle = 'rgba(0,0,0,0.03)';
    ctx.fillRect(0, 0, window.innerWidth, window.innerWidth);

    for (var i = 0; i < numParticles; i++) {
        var p = particles[i];
        p.draw(ctx);
    }

    ctx2.setTransform(1, 0, 0, 1, 0, 0);

    ctx2.globalCompositeOperation = 'source-over';

    ctx2.fillStyle = 'rgba(0,0,0,0.9)';
    ctx2.fillRect(0, 0, window.innerWidth, window.innerWidth);

//        ctx2.globalCompositeOperation = 'lighter';

//        ctx2.translate(window.innerWidth * 0.5, window.innerWidth * 0.5);
//        ctx2.rotate(globalRotation);
//        ctx2.scale(1 + globalScale, 1 + globalScale);
//        ctx2.translate(window.innerWidth * -0.5, window.innerWidth * -0.5);

//        ctx2.drawImage(cnv, 0, 0, window.innerWidth, window.innerWidth, 0, 0, window.innerWidth, window.innerWidth);

    globalRotation += 0.003;
    globalScale *= 0.9;

    var r1 = 1; //img1scale * -20;
    var r2 = 1; //img2scale * -20;
    var r3 = 1; //img3scale * -20;
    var r4 = 1; //img4scale * -20;

    var rz = 0; //Math.sin(globalRotation * 10) * 20;

//    var i1s = 'perspective(500) scale(' + (0.6 - img1scale) + ',' + (0.6 - img1scale) + ') rotateX(' + noe(r1 * 1) + 'deg) rotateY(' + noe(r1 * -1) + 'deg)';
//    var i2s = 'perspective(500) scale(' + (0.6 - img2scale) + ',' + (0.6 - img2scale) + ') rotateX(' + noe(r2 * 1) + 'deg) rotateY(' + noe(r2 * 1) + 'deg)';
//    var i3s = 'perspective(500) scale(' + (0.6 - img3scale) + ',' + (0.6 - img3scale) + ') rotateX(' + noe(r3 * -1) + 'deg) rotateY(' + noe(r3 * -1) + 'deg)';
//    var i4s = 'perspective(500) scale(' + (0.6 - img4scale) + ',' + (0.6 - img4scale) + ') rotateX(' + noe(r4 * -1) + 'deg) rotateY(' + noe(r4 * 1) + 'deg)';

    var i1s = 'perspective(500) scale(' + (0.6 - img1scale) + ') rotate(' + rz + 'deg)';
    var i2s = 'perspective(500) scale(' + (0.6 - img2scale) + ') rotate(' + rz + 'deg)';
    var i3s = 'perspective(500) scale(' + (0.6 - img3scale) + ') rotate(' + rz + 'deg)';
    var i4s = 'perspective(500) scale(' + (0.6 - img4scale) + ') rotate(' + rz + 'deg)';

//    document.getElementById('instr').innerHTML = i1s;

    img1.style['-webkit-transform'] = i1s;
    img2.style['-webkit-transform'] = i2s;
    img3.style['-webkit-transform'] = i3s;
    img4.style['-webkit-transform'] = i4s;

//        img1.style['-webkit-transform'] = 'perspective(500) scale(' + (0.6 - img1scale) + ') rotateX(' + -r1 + 'deg) rotateY(' + r1 + 'deg) rotateZ(' + rz + 'deg)';
//        img2.style['-webkit-transform'] = 'perspective(500) scale(' + (0.6 - img2scale) + ') rotateX(' + -r2 + 'deg) rotateY(' + -r2 + 'deg) rotateZ(' + rz + 'deg)';
//        img3.style['-webkit-transform'] = 'perspective(500) scale(' + (0.6 - img3scale) + ') rotateX(' + r3 + 'deg) rotateY(' +  r3 + 'deg) rotateZ(' + rz + 'deg)';
//        img4.style['-webkit-transform'] = 'perspective(500) scale(' + (0.6 - img4scale) + ') rotateX(' + r4 + 'deg) rotateY(' + -r4 + 'deg) rotateZ(' + rz + 'deg)';

    img1scale *= 0.98;
    img2scale *= 0.96;
    img3scale *= 0.94;
    img4scale *= 0.92;

    imgsRotation *= 0.9;
}

</script>

</head>
<body>
<div id="container">
    <canvas id="cnv"></canvas>
    <canvas id="cnv2"></canvas>
</div>

<div id="images">
    <div id="tl"><img src="../assets/instgrm/bike.jpg"></div>
    <div id="tr"><img src="../assets/instgrm/bubble.jpg"></div>
    <div id="bl"><img src="../assets/instgrm/sunset.jpg"></div>
    <div id="br"><img src="../assets/instgrm/trees.jpg"></div>
</div>

<div id="instr">Click anywhere to add a beat</div>

</body>
</html>

















