<!DOCTYPE html>
<html>
<head>
    <title>Sun and moon | v0.1</title>

    <style type="text/css">

        body {
            background-color: #000000;
        }

        #cnv {
            position: absolute;
            top: 0px;
            left: 0px;
            background-color: #000000;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

    </style>

    <script type="text/javascript" src="../../lib/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../build/squareroot-min.js"></script>
<!-- SQRLIB -->

    <script type="text/javascript">

        var ctx;
        var sun, moon;

        var attraction = new SQR.V2();
        var repulsion = new SQR.V2();

        var G = 10;

        window.onload = function() {

            var cnv = document.getElementById('cnv');
            ctx = cnv.getContext('2d');

//            document.addEventListener('click', function(e) { }, false);
//            document.addEventListener('keydown', function(e) { }, false);

            SQR.Particle.prototype.draw = function(ctx) {
                ctx.fillStyle = 'rgb(255,0,0)';
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, SQR.twoPI);
                ctx.fill();
            }

            cnv.width = window.innerWidth;
            cnv.height = window.innerHeight;

            sun = new SQR.Particle(new SQR.V2(window.innerWidth * 0.5, window.innerHeight * 0.5));
            sun.radius = 20;
            sun.mass = 200;

            moon = new SQR.Particle(new SQR.V2(window.innerWidth * 0.5, window.innerHeight * 0.5 - 40));
            moon.radius = 4;
            moon.mass = 1;
            moon.addForce(new SQR.V2(2, 2));
            
            draw();

        }

        function draw() {
            requestAnimFrame(draw);

            SQR.Time.tick();

            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            ctx.globalAlpha = 0.4;

            attraction.sub(sun.position, moon.position);

            var distance = attraction.mag();
            distance = SQR.Mathx.clamp(distance, 20, 25);
            
            attraction.norm();
            var strength = (G * sun.mass * moon.mass) / (distance * distance);
            attraction.mul(strength);

            repulsion.sub(sun.position, moon.position);
            var distance = repulsion.mag();
            repulsion.neg().mul(1 / distance);

//            sun.addForce(attraction);
            moon.addForce(attraction);
            moon.addForce(repulsion);

            sun.update(SQR.Time.deltaTime);
            sun.draw(ctx);

            moon.update(SQR.Time.deltaTime);
            moon.draw(ctx);
        }

    </script>

</head>
<body>
<div id="container">
    <canvas id="cnv"></canvas>
</div>

<div id="instr"></div>

</body>
</html>

















