SQR.Primitives.createCube=function(a,e,n){a=a||1,e=e||1,n=n||1;var r=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},36),t=new SQR.V3(a*-.5,.5*e,.5*n),o=new SQR.V3(.5*a,.5*e,.5*n),s=new SQR.V3(a*-.5,e*-.5,.5*n),u=new SQR.V3(.5*a,e*-.5,.5*n),i=new SQR.V3(a*-.5,.5*e,n*-.5),c=new SQR.V3(.5*a,.5*e,n*-.5),l=new SQR.V3(a*-.5,e*-.5,n*-.5),f=new SQR.V3(.5*a,e*-.5,n*-.5),v=new SQR.V2(0,1),S=new SQR.V2(1,1),m=new SQR.V2(0,0),Q=new SQR.V2(1,0),R=[];R.push(SQR.Face().setPosition(t,o,s,u).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(c,i,f,l).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(i,t,l,s).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(o,c,u,f).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(i,c,t,o).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(s,u,l,f).setUV(v,S,m,Q));var h=0;return R.forEach(function(a){h+=a.calculateNormal().toBuffer(r,h)}),r},SQR.Primitives.createCylinder=function(a,e,n,r){r=r||{};var t,o,s,u,i,c,l=[],f=function(a,e,n,r,t,o,s,u){var i=(new SQR.Face).setPosition(a,e,n,r).setUV(t,o,s,u);l.push(i)};t=[],o=[],s=[],u=[];for(var v=0;n>v;v++){var S=new SQR.V3,m=new SQR.V3,Q=new SQR.V2,R=new SQR.V2,h=Math.cos(v/n*SQR.TWOPI)*e,V=Math.sin(v/n*SQR.TWOPI)*e;r.vertical?(S.set(V,a*-.5,h),m.set(V,.5*a,h)):(S.set(a*-.5,h,V),m.set(.5*a,h,V)),Q.set(v/n,0),R.set(v/n,1),r.noCaps||(r.vertical?(i=new SQR.V3(0,a*-.5,0),c=new SQR.V3(0,.5*a,0)):(i=new SQR.V3(a*-.5,0,0),c=new SQR.V3(.5*a,0,0))),t.push(S),o.push(m),s.push(Q),u.push(R),r.insideFaces&&(S._inside=S.clone(),m._inside=m.clone())}for(var v=0;n>v;v++){var d=t[v],w=o[v],P=s[v],p=u[v],b=(v+1)%n,_=t[b],g=o[b],N=s[b],U=u[b];f(d,w,_,g,P,p,N,U),r.noCaps?r.insideFaces&&f(d._inside,_._inside,w._inside,g._inside,P,p,N,U):(f(d,_,i,null,p,U,N),f(g,w,c,null,U,p,N))}var S,F=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*l.length),M=0;return l.forEach(function(a){M+=a.calculateNormal().toBuffer(F,M)}),F},SQR.Extrude=function(){var a={};a.buffer=SQR.Buffer();var e,n,r,t,o,s,u,i=[],c=[];a.setPaths=function(o,s,u,i){return e=o,n=o.length,r=s,t=u||10,l(i),a},a.makeCaps=function(){return a};var l=function(e){i.length=0,c.length=0,e=e||SQR.v3n3();for(var r=0;t>r;r++)for(var o=0;n>o;o++){var s=new SQR.V3;i.push(s)}for(var r=0;t-1>r;r++)for(var o=0;n>o;o++){var u=r*n+o,l=n-1>o?u+1:r*n,f=(r+1)*n+o,v=n-1>o?f+1:(r+1)*n,S=(new SQR.Face).setPosition(i[u],i[v],i[l]),m=(new SQR.Face).setPosition(i[u],i[f],i[v]);c.push(S,m)}a.buffer.layout(e,3*c.length)},f=function(u){for(var l=0;t>l;l++)for(var f=l/(t-1),v=s+f*o,S=r.matrixAt(v),m=0;n>m;m++){var Q=i[l*n+m];Q.copyFrom(e[m]),u&&u(f,Q),S.transformVector(Q)}for(var R=0,l=0,h=c.length;h>l;l++)R+=c[l].calculateNormal().toBuffer(a.buffer,R,!1,!0)};return a.update=function(e,n,r){return s=e||0,u=n||1,o=u-s,f(r),a.buffer.update(),a},a},SQR.Face=function(){var a={},e="aPosition",n="aNormal",r="aUV";return a.setPosition=function(e,n,r,t){return a.a=e,a.b=n,a.c=r,a.d=t,a},a.setNormal=function(e){return a.normal=e,a},a.setUV=function(e,n,r,t){return a.uva=e,a.uvb=n,a.uvc=r,a.uvd=t,a},a.setColor=function(e,n,r,t){return a.ca=e,a.cb=n,a.cc=r,a.cd=t,a},a.calculateNormal=function(){var e=SQR.V3.__tv1,n=SQR.V3.__tv2;return a.normal=new SQR.V3,e.sub(a.a,a.b),e.isZero()&&e.sub(a.a,a.d),n.sub(a.c,a.a),a.normal.cross(e,n),a},a.addNormalToVertices=function(){return a.a.addNormal(a.normal),a.b.addNormal(a.normal),a.c.addNormal(a.normal),a.d&&a.d.addNormal(a.normal),a},a.toBuffer=function(t,o,s,u){var i=o;if(t.attributes[e]&&(t.set(e,i+0,a.a).set(e,i+1,a.b).set(e,i+2,a.c),a.d&&t.set(e,i+3,a.c).set(e,i+4,a.b).set(e,i+5,a.d)),t.attributes[n]&&(a.normal||s)){var c=s,l=a.normal;u&&!c&&a.normal.norm(),t.set(n,i+0,c?a.a.normal:l).set(n,i+1,c?a.b.normal:l).set(n,i+2,c?a.c.normal:l),a.d&&t.set(n,i+3,c?a.c.normal:l).set(n,i+4,c?a.b.normal:l).set(n,i+5,c?a.d.normal:l)}return t.attributes[r]&&a.uva&&(t.set(r,i+0,a.uva).set(r,i+1,a.uvb).set(r,i+2,a.uvc),a.d&&t.set(r,i+3,a.uvc).set(r,i+4,a.uvb).set(r,i+5,a.uvd)),a.d?6:3},a},SQR.Primitives.createIcosphere=function(a,e,n){var r=[],t=[],o=[],s=0;n=n||{};var u=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],i=new SQR.V3,c=(new SQR.V3(0,1,0),new SQR.V3(0,0,1),function(a){var e,n;return i.copyFrom(a),i.norm(),e=1-(.5+Math.atan2(i.z,i.x)/SQR.TWOPI),n=1-(.5-Math.asin(i.y)/Math.PI),new SQR.V2(e,n)}),l=function(a,e,n,t,o,s){var u=c(a),i=c(e),l=c(n),f=(new SQR.Face).setPosition(a,e,n).setUV(u,i,l).setColor(t,o,s);r.push(f)},f=function(e,n){for(var r=t.length,o=0;r>o;o++){var s=t[o],u=s.__v1==e&&s.__v2==n,i=s.__v2==e&&s.__v1==n;if(u||i)return s}var c=new SQR.V3;return c.sub(e,n).mul(.5).add(c,n).norm().mul(a),c.__v1=e,c.__v2=n,t.push(c),c.normal=c.clone(),c},v=function(){o[s]={};var a=o[s];a.faces=r,a.vectors=t,r=[];for(var e=a.faces.length,n=0;e>n;n++){var i=a.faces[n],c=f(i.a,i.b),v=f(i.a,i.c),S=f(i.b,i.c),m=u[s+1];l(i.a,c,v,i.ca,m,m),l(i.b,S,c,i.cb,m,m),l(i.c,v,S,i.cc,m,m),l(c,S,v,m,m,m)}s++},S=a,m=.5*(1+Math.sqrt(5))*S,Q=function(e,n,r){var o=new SQR.V3(e,n,r).norm();o.normal=o.clone(),o.mul(a),t.push(o)},R=function(a,e,n){var r=u[0];l(t[a],t[n],t[e],r,r,r)};for(Q(-S,m,0),Q(S,m,0),Q(-S,-m,0),Q(S,-m,0),Q(0,-S,m),Q(0,S,m),Q(0,-S,-m),Q(0,S,-m),Q(m,0,-S),Q(m,0,S),Q(-m,0,-S),Q(-m,0,S),R(0,11,5),R(0,5,1),R(0,1,7),R(0,7,10),R(0,10,11),R(1,5,9),R(5,11,4),R(11,10,2),R(10,7,6),R(7,1,8),R(3,9,4),R(3,4,2),R(3,2,6),R(3,6,8),R(3,8,9),R(4,9,5),R(2,4,11),R(6,2,10),R(8,6,7),R(9,8,1);e-->0;)v();var m,h=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},3*r.length),V=0;return r.forEach(function(a){n.flatShading&&a.calculateNormal(),V+=a.toBuffer(h,V,!n.flatShading)}),h},SQR.Primitives.create2DQuad=function(a,e,n,r){return SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",a,e+r,a+n,e,a+n,e+r,a+n,e,a,e+r,a,e).data("aUV",0,0,1,1,1,0,1,1,0,0,0,1).update()},SQR.Primitives.createPlane=function(a,e,n,r,t,o){var s=[],u=[],i=[],c=new SQR.Buffer,l=l||{};c.width=a,c.height=e;var a=.5*a,e=.5*e,t=t||0,o=o||0,n=n||1,r=r||1;s.length=[];var f,v,S=-a+t,m=-e+o,Q=c.width/n,R=c.height/r;for(f=0;n+1>f;f++)for(u[f]=[],i[f]=[],v=0;r+1>v;v++){var h=S+f*Q,V=m+v*R;i[f][v]=new SQR.V2(f/n,v/r),u[f][v]=l.zUp?new SQR.V3(h,V,0):new SQR.V3(h,0,V)}for(f=0;n>f;f++)for(v=0;r>v;v++){var h=S+f*Q,V=m+v*R,d=u[f][v],w=u[f][v+1],P=u[f+1][v],p=u[f+1][v+1],b=i[f][v],_=i[f][v+1],g=i[f+1][v],N=i[f+1][v+1],U=(new SQR.Face).setPosition(d,w,P,p).setUV(b,_,g,N);s.push(U)}c.layout({aPosition:3,aNormal:3,aUV:2},n*r*6);var F=0;return s.forEach(function(a){F+=a.calculateNormal().toBuffer(c,F)}),c},SQR.Primitives.createSphere=function(a,e,n,r){var t=[],o=[],s=[];r=r||{};var u,i,a=a||50,c=Math.max(3,Math.floor(e)||8),l=Math.max(3,Math.floor(n)||6),f=0,v=2*Math.PI,S=0,m=Math.PI;for(i=0;l>=i;i++)for(u=0;c>=u;u++){var Q=u/c,R=i/l,h=-a*Math.cos(f+Q*v)*Math.sin(S+R*m),V=a*Math.cos(S+R*m),d=a*Math.sin(f+Q*v)*Math.sin(S+R*m);t.push(new SQR.V3(h,V,d)),o.push(new SQR.V2(Q,1-R))}for(i=0;l>i;i++)for(u=0;c>u;u++){var w,P=c+1,p=t[i*P+u+0],b=t[i*P+u+1],_=t[(i+1)*P+u+1],g=t[(i+1)*P+u+0],N=o[i*P+u+0],U=o[i*P+u+1],F=o[(i+1)*P+u+1],M=o[(i+1)*P+u+0];w=r.reverseNormals?(new SQR.Face).setPosition(b,p,_,g).setUV(U,N,F,M):(new SQR.Face).setPosition(p,b,g,_).setUV(N,U,M,F),r.flatShading?w.calculateNormal():(p.normal=p.clone().norm(),b.normal=b.clone().norm(),_.normal=_.clone().norm(),g.normal=g.clone().norm(),r.reverseNormals&&(p.normal.neg(),b.normal.neg(),_.normal.neg(),g.normal.neg())),s.push(w)}var B=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*s.length),y=0;return s.forEach(function(a){y+=a.toBuffer(B,y,!r.flatShading)}),B};