SQR.Bezier=function(t,i,n,r){var s=this;this.p0=t,this.c0=i,this.c1=n,this.p1=r;var e,h,a,o=SQR.Interpolation.bezierPosition,u=SQR.Interpolation.bezierVelocity;this.velocityAt=function(t,i){return h=h||this.p0.clone().set(),i=i||h,i.x=u(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),i.y=u(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==i.z&&null!==this.p0.z&&(i.z=u(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),i},this.valueAt=function(t,i){return e=e||this.p0.clone().set(),i=i||e,i.x=o(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),i.y=o(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==i.z&&null!==this.p0.z&&(i.z=o(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),i},this.matrixAt=function(t,i){a=a||new SQR.Matrix44,i=i||a,i.identity();var n=s.valueAt(t),r=s.velocityAt(t).norm(),e=SQR.V3.__tv1.set().cross(r,SQR.V3.up),h=SQR.V3.__tv2.set().cross(r,e);return i.data[0]=e.x,i.data[4]=h.x,i.data[8]=r.x,i.data[1]=e.y,i.data[5]=h.y,i.data[9]=r.y,i.data[2]=e.z,i.data[6]=h.z,i.data[10]=r.z,i.setTranslation(n.x,n.y,n.z),i}},SQR.ConvexHull=function(){var t=[],i=[],n=[],r=function(t,i){return t.x==i.x?t.y-i.y:t.x-i.x},s=function(t,i,n){return n.x*t.y-n.y*t.x-(i.x*t.y-i.y*t.x)+(i.x*n.y-i.y*n.x)<0},e=function(t,i){i.push(t[0]),i.push(t[1]);for(var n=2,r=t.length;r>n;n++)for(i.push(t[n]);i.length>2&&!s(i[i.length-3],i[i.length-1],i[i.length-2]);)i.splice(i.indexOf(i[i.length-2]),1);return i},h=function(t,i){i.push(t[t.length-1]),i.push(t[t.length-2]);for(var n=t.length-3;n>=0;n--)for(i.push(t[n]);i.length>2&&!s(i[i.length-3],i[i.length-1],i[i.length-2]);)i.splice(i.indexOf(i[i.length-2]),1);return i};return{compute:function(s,a){return a||(a=n),t.length=0,i.length=0,a.length=0,s.sort(r),e(s,t),h(s,i),a=a.concat(t,i)}}}(),SQR.Delaunay=function(){function t(t,i){var r=[];return i=i.filter(function(i){return i.vertexInCircumcircle(t)?(r.push(new n(i.v0,i.v1)),r.push(new n(i.v1,i.v2)),r.push(new n(i.v2,i.v0)),!1):!0}),r=s(r),r.forEach(function(n){i.push(new SQR.Triangle(n.v0,n.v1,t))}),i}var i={},n=function(t,i){this.v0=t,this.v1=i};n.prototype.equals=function(t){return this.v0===t.v0&&this.v1===t.v1},n.prototype.inverse=function(){return new n(this.v1,this.v0)};var r=function(t){var i,n,r,s;t.forEach(function(t){(void 0===i||t.x<i)&&(i=t.x),(void 0===n||t.y<n)&&(n=t.y),(void 0===r||t.x>r)&&(r=t.x),(void 0===s||t.y>s)&&(s=t.y)});var e=10*(r-i),h=10*(s-n),a=new SQR.V2(i-e,n-3*h),o=new SQR.V2(i-e,s+h),u=new SQR.V2(r+3*e,s+h);return new SQR.Triangle(a,o,u)},s=function(t){for(var i=[],n=0;n<t.length;++n){for(var r=t[n],s=!0,e=0;e<t.length;++e)if(n!==e){var h=t[e];if(r.equals(h)||r.inverse().equals(h)){s=!1;break}}s&&i.push(r)}return i};return i.triangulate=function(i){var n=[],s=r(i);return n.push(s),i.forEach(function(i){n=t(i,n)}),n=n.filter(function(t){return!(t.v0==s.v0||t.v0==s.v1||t.v0==s.v2||t.v1==s.v0||t.v1==s.v1||t.v1==s.v2||t.v2==s.v0||t.v2==s.v1||t.v2==s.v2)})},i}(),SQR.Interpolation={bezierPosition:function(t,i,n,r,s){return i*(1-t)*(1-t)*(1-t)+3*n*t*(1-t)*(1-t)+3*r*t*t*(1-t)+s*t*t*t},bezierVelocity:function(t,i,n,r,s){return 3*n-3*i+2*(3*i-6*n+3*r)*t+3*(-i+3*n-3*r+s)*t*t},linear:function(t,i,n){return t>=n?t:n>=i?i:(n=(n-t)/(i-t),t+(i-t)*n)},smoothStep:function(t,i,n){return t>=n?t:n>=i?i:(n=(n-t)/(i-t),t+(i-t)*(3*n*n-2*n*n*n))},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},SQR.Matrix2D=function(){this.data=new Float32Array(9);var t,i,n,r,s;this.identity=function(t){return t=t||this.data,t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t){return n=this.data,r=t.x,s=t.y,t.x=n[0]*r+n[1]*s+n[2],t.y=n[3]*r+n[4]*s+n[5],t},this.setTranslation=function(t,i,r){return n=r||this.data,n[0]=1,n[3]=0,n[6]=t,n[1]=0,n[4]=1,n[7]=i,n[2]=0,n[5]=0,n[8]=1,this},this.getTranslation=function(t){return n=this.data,t=t||new SQR.V2,t.x=n[2],t.y=n[5],t},this.setScale=function(t,i,r){return n=r||this.data,n[0]=t,n[3]=0,n[6]=0,n[1]=0,n[4]=i,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setShear=function(t,i,r){return n=r||this.data,n[0]=1,n[3]=t,n[6]=0,n[1]=i,n[4]=1,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setRotation=function(t,i){n=i||this.data;var r=Math.cos(t),s=Math.sin(t);return n[0]=r,n[3]=-s,n[6]=0,n[1]=s,n[4]=r,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setTRS=function(t,i,r,s,e){n=this.data;var h=Math.cos(r),a=Math.sin(r);return n[0]=h*s,n[3]=-a*e,n[6]=t,n[1]=a*s,n[4]=h*e,n[7]=i,n[2]=0,n[5]=0,n[8]=1,this},this.translate=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setTranslation(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.rotate=function(t){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.scale=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setScale(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.shear=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)};var e,h,a,o,u,c,y,p,x,v,f,Q,S,l,R,d,m,z;this.multiply=function(n){return t=this.data,i=n.data||n,e=t[0],h=t[3],a=t[6],o=t[1],u=t[4],c=t[7],y=t[2],p=t[5],x=t[8],v=i[0],f=i[3],Q=i[6],S=i[1],l=i[4],R=i[7],d=i[2],m=i[5],z=i[8],t[0]=e*v+h*S+a*d,t[3]=e*f+h*l+a*m,t[6]=e*Q+h*R+a*z,t[1]=o*v+u*S+c*d,t[4]=o*f+u*l+c*m,t[7]=o*Q+u*R+c*z,this},this.copyTo=function(n){return t=this.data,i=n.data||n,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],n},this.copyFrom=function(n){return t=n.data||n,i=this.data,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},this.identity()},SQR.Matrix2D.__temp=new Float32Array(9),SQR.Matrix33=function(){this.data=new Float32Array(9),this.identity=function(){var t=this.data;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t,i){var n=this.data,r=t.x,s=t.y,e=t.z;return i=i||t,i.x=n[0]*r+n[3]*s+n[6]*e,i.y=n[1]*r+n[4]*s+n[7]*e,i.z=n[2]*r+n[5]*s+n[8]*e,i},this.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])+t[3]*(t[7]*t[2]-t[1]*t[8])+t[6]*(t[1]*t[5]-t[4]*t[2])},this.inverse=function(t){var i=this.data;t=t||this.data;var n,r=i[0],s=i[1],e=i[2],h=i[3],a=i[4],o=i[5],u=i[6],c=i[7],y=i[8],p=y*a-o*c,x=-y*h+o*u,v=c*h-a*u,i=r*p+s*x+e*v;return i?(n=1/i,t[0]=p*n,t[1]=(-y*s+e*c)*n,t[2]=(o*s-e*a)*n,t[3]=x*n,t[4]=(y*r-e*u)*n,t[5]=(-o*r+e*h)*n,t[6]=v*n,t[7]=(-c*r+s*u)*n,t[8]=(a*r-s*h)*n,t):(console.warn("Attempt to inverse a singular matrix33. ",this.data),t)},this.transpose=function(){var t=this.data,i=t[0],n=t[3],r=t[6],s=t[1],e=t[4],h=t[7],a=t[2],o=t[5],u=t[8];t[0]=i,t[1]=n,t[2]=r,t[3]=s,t[4]=e,t[5]=h,t[6]=a,t[7]=o,t[8]=u}},SQR.Matrix44=function(t){this.data=t||new Float32Array(16),this.identity=function(t){var i=t||this.data;return i[0]=1,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=1,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=1,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},this.transformVector=function(t,i){var n=this.data,r=t.x,s=t.y,e=t.z,h=t.w;return i=i||t,i.x=n[0]*r+n[4]*s+n[8]*e+n[12]*h,i.y=n[1]*r+n[5]*s+n[9]*e+n[13]*h,i.z=n[2]*r+n[6]*s+n[10]*e+n[14]*h,i},this.multiply=function(t){var i,n,r,s,e,h,a,o,u,c,y,p,x,v,f,Q,S,l,R,d,m,z,w,M,V,_,g,A,T,q,P,C,b=this.data,D=t.data||t;return i=b[0],n=b[1],r=b[2],s=b[3],e=b[4],h=b[5],a=b[6],o=b[7],u=b[8],c=b[9],y=b[10],p=b[11],x=b[12],v=b[13],f=b[14],Q=b[15],S=D[0],l=D[1],R=D[2],d=D[3],m=D[4],z=D[5],w=D[6],M=D[7],V=D[8],_=D[9],g=D[10],A=D[11],T=D[12],q=D[13],P=D[14],C=D[15],b[0]=i*S+e*l+u*R+x*d,b[1]=n*S+h*l+c*R+v*d,b[2]=r*S+a*l+y*R+f*d,b[3]=s*S+o*l+p*R+Q*d,b[4]=i*m+e*z+u*w+x*M,b[5]=n*m+h*z+c*w+v*M,b[6]=r*m+a*z+y*w+f*M,b[7]=s*m+o*z+p*w+Q*M,b[8]=i*V+e*_+u*g+x*A,b[9]=n*V+h*_+c*g+v*A,b[10]=r*V+a*_+y*g+f*A,b[11]=s*V+o*_+p*g+Q*A,b[12]=i*T+e*q+u*P+x*C,b[13]=n*T+h*q+c*P+v*C,b[14]=r*T+a*q+y*P+f*C,b[15]=s*T+o*q+p*P+Q*C,this},this.setTQS=function(t,i,n,r,s,e,h,a,o,u,c){var y=c||this.data;this.identity(c);var p=s*s,x=e*e,v=h*h;return y[0]=(1-2*x-2*v)*a,y[1]=(2*s*e-2*h*r)*a,y[2]=(2*s*h+2*e*r)*a,y[4]=(2*s*e+2*h*r)*o,y[5]=(1-2*p-2*v)*o,y[6]=(2*e*h-2*s*r)*o,y[8]=(2*s*h-2*e*r)*u,y[9]=(2*e*h+2*s*r)*u,y[10]=(1-2*p-2*x)*u,y[12]=t,y[13]=i,y[14]=n,c||this},this.setTRS=function(t,i,n,r,s,e,h,a,o,u){var c=u||this.data;this.identity(u);var y=Math.sin(r),p=Math.cos(r),x=Math.sin(s),v=Math.cos(s),f=Math.sin(e),Q=Math.cos(e);return c[0]=(v*Q+x*y*f)*h,c[1]=(-v*f+x*y*Q)*h,c[2]=x*p*h,c[4]=f*p*a,c[5]=Q*p*a,c[6]=-y*a,c[8]=(-x*Q+v*y*f)*o,c[9]=(f*x+v*y*Q)*o,c[10]=v*p*o,c[12]=t,c[13]=i,c[14]=n,u||this},this.setScale=function(t,i,n,r){var s=r||this.data;return s[0]=t,s[5]=i,s[10]=n,r||this},this.setTranslation=function(t,i,n,r){var s=r||this.data;return s[12]=t,s[13]=i,s[14]=n,r||this},this.setRotation=function(t,i,n,r){var s=r||this.data,e=Math.sin(t),h=Math.cos(t),a=Math.sin(i),o=Math.cos(i),u=Math.sin(n),c=Math.cos(n);return s[0]=o*c+a*e*u,s[1]=-o*u+a*e*c,s[2]=a*h,s[4]=u*h,s[5]=c*h,s[6]=-e,s[8]=-a*c+o*e*u,s[9]=u*a+o*e*c,s[10]=o*h,r||this},this.translate=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setTranslation(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.rotate=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setRotation(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.scale=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setScale(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.copyTo=function(t){for(var i=this.data,n=t.data||t,r=0;16>r;r++)n[r]=i[r];return t},this.copyRotationTo=function(t){var i=this.data,n=t.data||t;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],t},this.extractPosition=function(t){var i=this.data;return t.set(i[12],i[13],i[14]),t},this.determinant=function(){var t=this.data;return t[0]*(t[5]*t[10]-t[9]*t[6])+t[4]*(t[9]*t[2]-t[1]*t[10])+t[8]*(t[1]*t[6]-t[5]*t[2])},this.inverse=function(t){var i=this.data,n=t?t.data||t:this.data,r=i[0],s=i[1],e=i[2],h=i[3],a=i[4],o=i[5],u=i[6],c=i[7],y=i[8],p=i[9],x=i[10],v=i[11],f=i[12],Q=i[13],S=i[14],l=i[15],R=r*o-s*a,d=r*u-e*a,m=r*c-h*a,z=s*u-e*o,w=s*c-h*o,M=e*c-h*u,V=y*Q-p*f,_=y*S-x*f,g=y*l-v*f,A=p*S-x*Q,T=p*l-v*Q,q=x*l-v*S,P=R*q-d*T+m*A+z*g-w*_+M*V;return P?(P=1/P,n[0]=(o*q-u*T+c*A)*P,n[1]=(e*T-s*q-h*A)*P,n[2]=(Q*M-S*w+l*z)*P,n[3]=(x*w-p*M-v*z)*P,n[4]=(u*g-a*q-c*_)*P,n[5]=(r*q-e*g+h*_)*P,n[6]=(S*m-f*M-l*d)*P,n[7]=(y*M-x*m+v*d)*P,n[8]=(a*T-o*g+c*V)*P,n[9]=(s*g-r*T-h*V)*P,n[10]=(f*w-Q*m+l*R)*P,n[11]=(p*m-y*w-v*R)*P,n[12]=(o*_-a*A-u*V)*P,n[13]=(r*A-s*_+e*V)*P,n[14]=(Q*d-f*z-S*R)*P,n[15]=(y*z-p*d+x*R)*P,t):null},this.inverseMat3=function(t){var i=this.data,n=t.data,r=this.determinant();if(Math.abs(r)<1e-4)return console.warn("Attempt to inverse a singular matrix44. ",this.data),console.trace(),t;{var s=i[0],e=i[4],h=i[8],a=(i[12],i[1]),o=i[5],u=i[9],c=(i[13],i[2]),y=i[6],p=i[10];i[14]}return r=1/r,n[0]=(o*p-u*y)*r,n[1]=(h*y-e*p)*r,n[2]=(e*u-h*o)*r,n[3]=(u*c-a*p)*r,n[4]=(s*p-h*c)*r,n[5]=(h*a-s*u)*r,n[6]=(a*y-o*c)*r,n[7]=(e*c-s*y)*r,n[8]=(s*o-e*a)*r,t},this.transpose=function(t){var i=this.data,n=t?t.data||t:this.data,r=i[0],s=i[4],e=i[8],h=i[1],a=i[5],o=i[9],u=i[2],c=i[6],y=i[10];n[0]=r,n[1]=s,n[2]=e,n[4]=h,n[5]=a,n[6]=o,n[8]=u,n[9]=c,n[10]=y},this.lookAt=function(t,i){var n=this.data,r=SQR.V3.__tv1,s=SQR.V3.__tv2,e=SQR.V3.__tv3;return i=i||SQR.V3.up,e.set(n[12],n[13],n[14]),e.sub(e,t).norm(),0===e.magsq()&&(e.z=1),r.cross(i,e).norm(),0===r.magsq()&&(e.x+=1e-4,r.cross(i,e).norm()),s.cross(e,r),n[0]=r.x,n[4]=s.x,n[8]=e.x,n[1]=r.y,n[5]=s.y,n[9]=e.y,n[2]=r.z,n[6]=s.z,n[10]=e.z,this},t||this.identity()},SQR.Matrix44.__temp=new Float32Array(16),SQR.ProjectionMatrix=function(){"undefined"==typeof Float32Array&&(Float32Array=Array),this.data=new Float32Array(16),this.copyTo=function(t){for(var i=this.data,n=t.data||t,r=0;16>r;r++)n[r]=i[r];return t},this.identity()},SQR.ProjectionMatrix.prototype.identity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},SQR.ProjectionMatrix.prototype.screenPixels2d=function(){return this.orthographic(0,window.innerWidth,0,window.innerHeight,-1,1),this},SQR.ProjectionMatrix.prototype.orthographic=function(t,i,n,r,s,e){var h=this.data;this.near=s,this.far=e;var a=i-t,o=n-r,u=e-s,c=(i+t)/a,y=(n+r)/o,p=(e+s)/u;return h[0]=2/a,h[4]=0,h[8]=0,h[12]=-c,h[1]=0,h[5]=2/o,h[9]=0,h[13]=-y,h[2]=0,h[6]=0,h[10]=-2/u,h[14]=-p,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},SQR.ProjectionMatrix.prototype.frustum=function(t,i,n,r,s,e){var h=this.data,a=2*s/(i-t),o=2*s/(r-n),u=(i+t)/(i-t),c=(r+n)/(r-n),y=-(e+s)/(e-s),p=-2*e*s/(e-s);return h[0]=a,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=o,h[9]=c,h[13]=0,h[2]=0,h[6]=0,h[10]=y,h[14]=p,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},SQR.ProjectionMatrix.prototype.perspective2=function(t,i,n,r){var s=n*Math.tan(t*Math.PI/360),e=-s,h=e*i,a=s*i;return this.frustum(h,a,e,s,n,r)},SQR.ProjectionMatrix.prototype.perspective=function(t,i,n,r){this.near=n,this.far=r;var s=this.data,e=n*Math.tan(t*Math.PI/360),h=r-n;return s[0]=n/(e*i),s[4]=0,s[8]=0,s[12]=0,s[1]=0,s[5]=n/e,s[9]=0,s[13]=0,s[2]=0,s[6]=0,s[10]=-(r+n)/h,s[14]=-(2*r*n)/h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},SQR.ProjectionMatrix.prototype.transformVector=function(t,i){var n=t.x,r=t.y,s=t.z,e=t.w,h=this.data;return i=i||t,i.x=h[0]*n+h[4]*r+h[8]*s+h[12]*e,i.y=h[1]*n+h[5]*r+h[9]*s+h[13]*e,i.z=h[2]*n+h[6]*r+h[10]*s+h[14]*e,i},SQR.ProjectionMatrix.prototype.inverse=function(t){var i=this.data;t=t||this.data;var n,r=i[0],s=i[1],e=i[2],h=i[3],a=i[4],o=i[5],u=i[6],c=i[7],y=i[8],p=i[9],x=i[10],v=i[11],f=i[12],Q=i[13],S=i[14],l=i[15],R=r*o-s*a,d=r*u-e*a,m=r*c-h*a,z=s*u-e*o,w=s*c-h*o,M=e*c-h*u,V=y*Q-p*f,_=y*S-x*f,g=y*l-v*f,A=p*S-x*Q,T=p*l-v*Q,q=x*l-v*S,P=R*q-d*T+m*A+z*g-w*_+M*V;return P?(n=1/P,t[0]=(o*q-u*T+c*A)*n,t[1]=(-s*q+e*T-h*A)*n,t[2]=(Q*M-S*w+l*z)*n,t[3]=(-p*M+x*w-v*z)*n,t[4]=(-a*q+u*g-c*_)*n,t[5]=(r*q-e*g+h*_)*n,t[6]=(-f*M+S*m-l*d)*n,t[7]=(y*M-x*m+v*d)*n,t[8]=(a*T-o*g+c*V)*n,t[9]=(-r*T+s*g-h*V)*n,t[10]=(f*w-Q*m+l*R)*n,t[11]=(-y*w+p*m-v*R)*n,t[12]=(-a*A+o*_-u*V)*n,t[13]=(r*A-s*_+e*V)*n,t[14]=(-f*z+Q*d-S*R)*n,t[15]=(y*z-p*d+x*R)*n,t):null},SQR.Quaternion=function(t,i,n,r){this.set(r,t,i,n)},SQR.Quaternion.prototype.set=function(t,i,n,r){return this.w=r||1,this.x=t||0,this.y=i||0,this.z=n||0,this},SQR.Quaternion.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,this},SQR.Quaternion.prototype.copyFrom=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},SQR.Quaternion.prototype.identity=function(){return this.set(),this},SQR.Quaternion.prototype.mul=function(t,i){i=i||this;var n=i.w*t.w-i.x*t.x-i.y*t.y-i.z*t.z,r=i.w*t.x+i.x*t.w+i.y*t.z-i.z*t.y,s=i.w*t.y-i.x*t.z+i.y*t.w+i.z*t.x,e=i.w*t.z+i.x*t.y-i.y*t.x+i.z*t.w;return i.set(r,s,e,n),i.normalize(),i},SQR.Quaternion.prototype.lookAt=function(t,i){var n=SQR.Quaternion.__tv1,r=SQR.Quaternion.__tv2,s=SQR.Quaternion.__tv3;t.copyTo(n),i.copyTo(s),n.norm(),-1==n.z&&(n.x=1e-4,n.norm()),r.cross(s,n),s.cross(n,r),this.w=.5*Math.sqrt(1+r.x+s.y+n.z);var e=4*this.w;return this.x=(n.y-s.z)/e,this.y=(r.z-n.x)/e,this.z=(s.x-r.y)/e,this.normalize(),this},SQR.Quaternion.prototype.fromAngleAxis=function(t,i,n,r){var s=Math.sin(t/2);this.x=i*s,this.y=n*s,this.z=r*s,this.w=Math.cos(t/2)},SQR.Quaternion.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},SQR.Quaternion.prototype.normalize=function(){var t=this.mag();this.x/=t,this.y/=t,this.z/=t,this.w/=t},SQR.Quaternion.prototype.toMatrix=function(){throw"SQR.Quaternion.toMatrix() is not implemented. Check SQR.Matrix44.TQS()"},SQR.Quaternion.slerp=function(t,i,n,r){r=r||new SQR.Quaternion;var s=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z,e=Math.acos(s),h=Math.sqrt(1-s*s),a=Math.sin((1-n)*e)/h,o=Math.sin(n*e)/h;return Math.abs(s)>=1?(a=1,o=0):Math.abs(h)<.001&&(a=.5,o=.5),r.w=i.w*a+t.w*o,r.x=i.x*a+t.x*o,r.y=i.y*a+t.y*o,r.z=i.z*a+t.z*o,r},SQR.Quaternion.prototype.slerp=function(t,i,n){SQR.Quaternion.slerp(t,i,n,this)},SQR.Quaternion.__tv1=new SQR.Quaternion,SQR.Quaternion.__tv2=new SQR.Quaternion,SQR.Quaternion.__tv3=new SQR.Quaternion,SQR.Spline=function(){var t,i,n=[],r=[],s=[],e={},h=function(n,r,s,e,h,a){var o=t.sub(n,r).neg(),u=i.sub(n,s),c=a>1?a:a*Math.min(o.mag(),u.mag());e.set().add(o,u).norm().mul(c),h.copyFrom(e).neg(),e.add(e,n),h.add(h,n)};return e.addSegment=function(n){var h;if(n.x)h=n;else{var a=arguments,o=a.length;2==o?h=new SQR.V2(a[0],a[1]):3==o&&(h=new SQR.V3(a[0],a[1],a[2]))}return r.push(h),s.push(h.clone(),h.clone()),t||(t=r[0].clone(),i=r[0].clone()),e},e.create=function(t,i){if(r.length<2)return r;t=null!==t?t:.5,n.length=0;for(var a=r,o=s,u=r.length,c=0;u>c;c++){var y=a[c],p=o[2*c].set(),x=o[2*c+1].set(),v=0==c?a[u-1]:a[c-1],f=c==u-1?a[0]:a[c+1];h(y,v,f,p,x,t),o.push(p,x)}for(var c=0;u-1>c;c++){var v=a[c],f=c==u-1?a[0]:a[c+1],p=0!=c||i?o[2*c+1]:v,x=c!=u-2||i?o[2*c+2]:f,Q=new SQR.Bezier(v,p,x,f);n.push(Q)}if(i){var Q=new SQR.Bezier(a[u-1],o[2*(u-1)+1],o[0],a[0]);n.push(Q)}return e},e.valueAt=function(t,i){1==t&&(t=.999999),t%=1;var r=t*n.length;return n[0|r].valueAt(r%1,i)},e.velocityAt=function(t,i){1==t&&(t=.999999),t%=1;var r=t*n.length;return n[0|r].velocityAt(r%1,i)},e.matrixAt=function(t,i){0==t&&(t=SQR.EPSILON),1==t&&(t=1-SQR.EPSILON),t%=1;var r=t*n.length;return n[0|r].matrixAt(r%1,i)},Object.defineProperty(e,"segments",{get:function(){return r}}),Object.defineProperty(e,"points",{get:function(){return n}}),e},SQR.Triangle=function(t,i,n){this.v0=t,this.v1=i,this.v2=n,this.calculateCentroid=function(){this.centroid=new SQR.V2,this.centroid.x=(this.v0.x+this.v1.x+this.v2.x)/3,this.centroid.y=(this.v0.y+this.v1.y+this.v2.y)/3},this.calculateCircumCircle=function(){var t,i,n=this.v1.x-this.v0.x,r=this.v1.y-this.v0.y,s=this.v2.x-this.v0.x,e=this.v2.y-this.v0.y,h=n*(this.v0.x+this.v1.x)+r*(this.v0.y+this.v1.y),a=s*(this.v0.x+this.v2.x)+e*(this.v0.y+this.v2.y),o=2*(n*(this.v2.y-this.v1.y)-r*(this.v2.x-this.v1.x));if(Math.abs(o)<SQR.EPSILON){var u=Math.min(this.v0.x,this.v1.x,this.v2.x),c=Math.min(this.v0.y,this.v1.y,this.v2.y),y=Math.max(this.v0.x,this.v1.x,this.v2.x),p=Math.max(this.v0.y,this.v1.y,this.v2.y);this.circumCenter=new SQR.V2((u+y)/2,(c+p)/2),t=this.circumCenter.x-u,i=this.circumCenter.y-c}else{var x=(e*h-r*a)/o,v=(n*a-s*h)/o;this.circumCenter=new SQR.V2(x,v),t=this.circumCenter.x-this.v0.x,i=this.circumCenter.y-this.v0.y}this.circumRadiusSq=t*t+i*i,this.circumRadius=Math.sqrt(this.circumRadiusSq)},this.vertexInCircumcircle=function(t){this.circumCenter||this.calculateCircumCircle();var i=this.circumCenter.x-t.x,n=this.circumCenter.y-t.y,r=i*i+n*n;return r<=this.circumRadiusSq}},SQR.V2=function(t,i){this.set(t,i),this.size=2},SQR.V2.prototype.set=function(t,i){return this.x=t||0,this.y=i||0,this},SQR.V2.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},SQR.V2.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},SQR.V2.prototype.clone=function(){return new SQR.V2(this.x,this.y)},SQR.V2.prototype.magsq=function(){return this.x*this.x+this.y*this.y},SQR.V2.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V2.prototype.isZero=function(){return 0==this.x&&0==this.y},SQR.V2.prototype.mul=function(t){return this.x*=t,this.y*=t,this},SQR.V2.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},SQR.V2.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t),this},SQR.V2.prototype.add=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},SQR.V2.prototype.sub=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},SQR.V2.prototype.lerp=function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this},SQR.V2.dot=function(t,i){return t.x*i.x+t.y*i.y},SQR.V2.prototype.perp=function(){return this.set(this.y,-this.x),this},SQR.V2.prototype.toUniform=function(){return toArray()},SQR.V2.prototype.toArray=function(){return this.array||(this.array=new Float32Array(2)),this.array[0]=this.x,this.array[1]=this.y,this.array},SQR.V3=function(t,i,n,r){this.x=t||0,this.y=i||0,this.z=n||0,this.w=r||1,this.size=3},SQR.V3.prototype.set=function(t,i,n,r){return this.x=t||0,this.y=i||0,this.z=n||0,this.w=r||1,this},SQR.V3.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},SQR.V3.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z||0,this.w=void 0!==t.w?t.w:1,this},SQR.V3.prototype.clone=function(){return new SQR.V3(this.x,this.y,this.z)},SQR.V3.prototype.magsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},SQR.V3.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V3.prototype.isZero=function(){return 0==this.x&&0==this.y&&0==this.z},SQR.V3.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},SQR.V3.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},SQR.V3.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t,this.z*t),this},SQR.V3.prototype.add=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},SQR.V3.prototype.sub=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},SQR.V3.prototype.lerp=function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this},SQR.V3.prototype.random=function(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this.z=2*Math.random()-1,this},SQR.V3.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},SQR.V3.prototype.cross=function(t,i){var n=t.y*i.z-t.z*i.y,r=t.z*i.x-t.x*i.z,s=t.x*i.y-t.y*i.x;return this.set(n,r,s,this.w),this},SQR.V3.prototype.toUniform=function(){return this.toArray()},SQR.V3.prototype.toArray=function(){return this.array||(this.array=new Float32Array(3)),this.array[0]=this.x,this.array[1]=this.y,this.array[2]=this.z,this.array},SQR.V3.prototype.toScreenSpace=function(t,i){t=t||window.innerWidth,i=i||window.innerHeight,this.x=this.x/this.z*t/2+t/2,this.y=this.y/this.z*i/2+i/2},SQR.V3.prototype.addNormal=function(t){this.normal||(this.normal=new SQR.V3),this.normal.add(this.normal,t)},SQR.V3.prototype.resetNormal=function(){this.normal&&this.normal.set()},SQR.V3.up=new SQR.V3(0,1,0),SQR.V3.forward=new SQR.V3(0,0,1),SQR.V3.__tv1=new SQR.V3,SQR.V3.__tv2=new SQR.V3,SQR.V3.__tv3=new SQR.V3;