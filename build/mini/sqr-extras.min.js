SQR.GeometryTools=function(){var e={};return e.batch=function(e){var t=[],n=0,r=function(a){if(a.transformWorld(),a.numChildren>0)for(var o=0;o<a.numChildren;o++)r(a.children[o]);a.buffer&&(a.buffer.isIndexed()?console.warn("> SQR.GeometryTools.batch - indexed buffers can't be batched"):(t.push(a),n+=a.buffer.size)),a.shader&&(e.shader=a.shader)};r(e);for(var a=SQR.Buffer().layout(t[0].buffer.layout,n),o=0,i=0,u=new SQR.V3,d=new SQR.Matrix33,s=0,c=0;c<t.length;c++){var f=t[c],m=t[c].buffer,h=new Float32Array(m.size*m.strideSize);h.set(m.getDataArray()),m.iterate("aPosition",function(e,t){u.set(t[e+0],t[e+1],t[e+2],1),f.globalMatrix.transformVector(u),h[e+0]=u.x,h[e+1]=u.y,h[e+2]=u.z}),m.iterate("aNormal",function(e,t){u.set(t[e+0],t[e+1],t[e+2]),f.globalMatrix.inverseMat3(d),d.transformVector(u),h[e+0]=u.x,h[e+1]=u.y,h[e+2]=u.z}),a.setRawData(h,o-i),o+=m.size*m.strideSize,s++}e.removeAll(),e.buffer=a.update()},e}(),SQR.TextureGenerator={noise:function(e,t){e=e||512,t=t||e;var n=document.createElement("canvas");n.width=e,n.height=t;for(var r=n.getContext("2d"),a=r.createImageData(e,t),o=a.data,i=0,u=o.length;u>i;i+=4)o[i+0]=255*Math.random()|0,o[i+1]=255*Math.random()|0,o[i+2]=255*Math.random()|0,o[i+3]=255;return r.putImageData(a,0,0),n}},SQR.Trackball=function(){var e={};e.rotation=new SQR.Quaternion;var t=function(e,t,n,r){n=n||.5,r=r||new SQR.V3;var a=e/n,o=t/n,i=a*a+o*o;return i>=1?r.set(a,o,0):r.set(a,o,Math.sqrt(1-i)),r.norm(),r},n=0,r=0,a=!1,o=new SQR.V3,i=new SQR.V3,u=new SQR.Quaternion,d=window.innerWidth/window.innerHeight,s=function(e){e="ontouchstart"in document?e.targetTouches[0]:e,n=(e.pageX/window.innerWidth*2-1)*d,r=-1*(e.pageY/window.innerHeight*2-1)},c=function(e){a=!0,s(e),t(n,r,1,o)},f=function(d){if(a){s(d),t(n,r,1,i);var c=SQR.V3.dot(o,i);o.cross(i,o),u.set(o.x,o.y,o.z,c),e.rotation.mul(u),o.copyFrom(i)}},m=function(){a=!1};return"ontouchstart"in document?(document.addEventListener("touchstart",c,!1),document.addEventListener("touchmove",f,!1),document.addEventListener("touchend",m,!1)):(document.addEventListener("mousedown",c,!1),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",m,!1)),e};