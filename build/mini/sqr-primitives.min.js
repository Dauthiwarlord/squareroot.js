SQR.Primitives.createCube=function(a,e,r){a=a||1,e=e||1,r=r||1;var n=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},36),t=new SQR.V3(a*-.5,.5*e,.5*r),o=new SQR.V3(.5*a,.5*e,.5*r),s=new SQR.V3(a*-.5,e*-.5,.5*r),u=new SQR.V3(.5*a,e*-.5,.5*r),i=new SQR.V3(a*-.5,.5*e,r*-.5),c=new SQR.V3(.5*a,.5*e,r*-.5),l=new SQR.V3(a*-.5,e*-.5,r*-.5),f=new SQR.V3(.5*a,e*-.5,r*-.5),v=new SQR.V2(0,1),S=new SQR.V2(1,1),m=new SQR.V2(0,0),Q=new SQR.V2(1,0),R=[];R.push(SQR.Face().setPosition(t,o,s,u).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(c,i,f,l).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(i,t,l,s).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(o,c,u,f).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(i,c,t,o).setUV(v,S,m,Q)),R.push(SQR.Face().setPosition(s,u,l,f).setUV(v,S,m,Q));var h=0;return R.forEach(function(a){h+=a.calculateNormal().toBuffer(n,h)}),n},SQR.Primitives.createCylinder=function(a,e,r,n){n=n||{};var t,o,s,u,i,c,l=[],f=function(a,e,r,n,t,o,s,u){var i=(new SQR.Face).setPosition(a,e,r,n).setUV(t,o,s,u);l.push(i)};t=[],o=[],s=[],u=[];for(var v=0;r>v;v++){var S=new SQR.V3,m=new SQR.V3,Q=new SQR.V2,R=new SQR.V2,h=Math.cos(v/r*SQR.TWOPI)*e,V=Math.sin(v/r*SQR.TWOPI)*e;n.vertical?(S.set(V,a*-.5,h),m.set(V,.5*a,h)):(S.set(a*-.5,h,V),m.set(.5*a,h,V)),Q.set(v/r,0),R.set(v/r,1),n.noCaps||(n.vertical?(i=new SQR.V3(0,a*-.5,0),c=new SQR.V3(0,.5*a,0)):(i=new SQR.V3(a*-.5,0,0),c=new SQR.V3(.5*a,0,0))),t.push(S),o.push(m),s.push(Q),u.push(R),n.insideFaces&&(S._inside=S.clone(),m._inside=m.clone())}for(var v=0;r>v;v++){var d=t[v],w=o[v],P=s[v],p=u[v],b=(v+1)%r,N=t[b],_=o[b],g=s[b],U=u[b];f(d,w,N,_,P,p,g,U),n.noCaps?n.insideFaces&&f(d._inside,N._inside,w._inside,_._inside,P,p,g,U):(f(d,N,i,null,p,U,g),f(_,w,c,null,U,p,g))}var S,F=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*l.length),M=0;return l.forEach(function(a){M+=a.calculateNormal().toBuffer(F,M)}),F},SQR.Extrude=function(){var a={};a.buffer=SQR.Buffer();var e,r,n,t,o,s,u,i=[],c=[];a.setPaths=function(o,s,u){return e=o,r=o.length,n=s,t=u||10,l(),a},a.makeCaps=function(){return a};var l=function(){i.length=0,c.length=0;for(var e=0;t>e;e++)for(var n=0;r>n;n++){var o=new SQR.V3;i.push(o)}for(var e=0;t-1>e;e++)for(var n=0;r>n;n++){var s=e*r+n,u=r-1>n?s+1:e*r,l=(e+1)*r+n,f=r-1>n?l+1:(e+1)*r,v=(new SQR.Face).setPosition(i[s],i[f],i[u]),S=(new SQR.Face).setPosition(i[s],i[l],i[f]);c.push(v,S)}a.buffer.layout({aPosition:3,aNormal:3},3*c.length)},f=function(u){for(var l=0;t>l;l++)for(var f=l/(t-1),v=s+f*o,S=n.matrixAt(v),m=0;r>m;m++){var Q=i[l*r+m];Q.copyFrom(e[m]),u&&u(f,Q),S.transformVector(Q)}for(var R=0,l=0,h=c.length;h>l;l++)R+=c[l].calculateNormal().toBuffer(a.buffer,R)};return a.update=function(e,r,n){return s=e||0,u=r||1,o=u-s,f(n),a.buffer.update(),a},a},SQR.Face=function(){var a={},e="aPosition",r="aNormal",n="aUV";return a.setPosition=function(e,r,n,t){return a.a=e,a.b=r,a.c=n,a.d=t,a},a.setNormal=function(e){return a.normal=e,a},a.setUV=function(e,r,n,t){return a.uva=e,a.uvb=r,a.uvc=n,a.uvd=t,a},a.setColor=function(e,r,n,t){return a.ca=e,a.cb=r,a.cc=n,a.cd=t,a},a.calculateNormal=function(){var e=SQR.V3.__tv1,r=SQR.V3.__tv2;return a.normal=new SQR.V3,e.sub(a.a,a.b),e.isZero()&&e.sub(a.a,a.d),r.sub(a.c,a.a),a.normal.cross(e,r),a},a.addNormalToVertices=function(){return a.a.addNormal(a.normal),a.b.addNormal(a.normal),a.c.addNormal(a.normal),a.d&&a.d.addNormal(a.normal),a},a.toBuffer=function(t,o,s){var u=o;if(t.attributes[e]&&(t.set(e,u+0,a.a).set(e,u+1,a.b).set(e,u+2,a.c),a.d&&t.set(e,u+3,a.c).set(e,u+4,a.b).set(e,u+5,a.d)),t.attributes[r]&&(a.normal||s)){var i=s,c=a.normal;t.set(r,u+0,i?a.a.normal:c).set(r,u+1,i?a.b.normal:c).set(r,u+2,i?a.c.normal:c),a.d&&t.set(r,u+3,i?a.c.normal:c).set(r,u+4,i?a.b.normal:c).set(r,u+5,i?a.d.normal:c)}return t.attributes[n]&&a.uva&&(t.set(n,u+0,a.uva).set(n,u+1,a.uvb).set(n,u+2,a.uvc),a.d&&t.set(n,u+3,a.uvc).set(n,u+4,a.uvb).set(n,u+5,a.uvd)),a.d?6:3},a},SQR.Primitives.createIcosphere=function(a,e,r){var n=[],t=[],o=[],s=0;r=r||{};var u=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],i=new SQR.V3,c=(new SQR.V3(0,1,0),new SQR.V3(0,0,1),function(a){var e,r;return i.copyFrom(a),i.norm(),e=1-(.5+Math.atan2(i.z,i.x)/SQR.TWOPI),r=1-(.5-Math.asin(i.y)/Math.PI),new SQR.V2(e,r)}),l=function(a,e,r,t,o,s){var u=c(a),i=c(e),l=c(r),f=(new SQR.Face).setPosition(a,e,r).setUV(u,i,l).setColor(t,o,s);n.push(f)},f=function(e,r){for(var n=t.length,o=0;n>o;o++){var s=t[o],u=s.__v1==e&&s.__v2==r,i=s.__v2==e&&s.__v1==r;if(u||i)return s}var c=new SQR.V3;return c.sub(e,r).mul(.5).add(c,r).norm().mul(a),c.__v1=e,c.__v2=r,t.push(c),c.normal=c.clone(),c},v=function(){o[s]={};var a=o[s];a.faces=n,a.vectors=t,n=[];for(var e=a.faces.length,r=0;e>r;r++){var i=a.faces[r],c=f(i.a,i.b),v=f(i.a,i.c),S=f(i.b,i.c),m=u[s+1];l(i.a,c,v,i.ca,m,m),l(i.b,S,c,i.cb,m,m),l(i.c,v,S,i.cc,m,m),l(c,S,v,m,m,m)}s++},S=a,m=.5*(1+Math.sqrt(5))*S,Q=function(e,r,n){var o=new SQR.V3(e,r,n).norm();o.normal=o.clone(),o.mul(a),t.push(o)},R=function(a,e,r){var n=u[0];l(t[a],t[r],t[e],n,n,n)};for(Q(-S,m,0),Q(S,m,0),Q(-S,-m,0),Q(S,-m,0),Q(0,-S,m),Q(0,S,m),Q(0,-S,-m),Q(0,S,-m),Q(m,0,-S),Q(m,0,S),Q(-m,0,-S),Q(-m,0,S),R(0,11,5),R(0,5,1),R(0,1,7),R(0,7,10),R(0,10,11),R(1,5,9),R(5,11,4),R(11,10,2),R(10,7,6),R(7,1,8),R(3,9,4),R(3,4,2),R(3,2,6),R(3,6,8),R(3,8,9),R(4,9,5),R(2,4,11),R(6,2,10),R(8,6,7),R(9,8,1);e-->0;)v();var m,h=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},3*n.length),V=0;return n.forEach(function(a){r.flatShading&&a.calculateNormal(),V+=a.toBuffer(h,V,!r.flatShading)}),h},SQR.Primitives.create2DQuad=function(a,e,r,n){return SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",a,e+n,a+r,e,a+r,e+n,a+r,e,a,e+n,a,e).data("aUV",0,0,1,1,1,0,1,1,0,0,0,1).update()},SQR.Primitives.createPlane=function(a,e,r,n,t,o){var s=[],u=[],i=[],c=new SQR.Buffer,l=l||{};c.width=a,c.height=e;var a=.5*a,e=.5*e,t=t||0,o=o||0,r=r||1,n=n||1;s.length=[];var f,v,S=-a+t,m=-e+o,Q=c.width/r,R=c.height/n;for(f=0;r+1>f;f++)for(u[f]=[],i[f]=[],v=0;n+1>v;v++){var h=S+f*Q,V=m+v*R;i[f][v]=new SQR.V2(f/r,v/n),u[f][v]=l.zUp?new SQR.V3(h,V,0):new SQR.V3(h,0,V)}for(f=0;r>f;f++)for(v=0;n>v;v++){var h=S+f*Q,V=m+v*R,d=u[f][v],w=u[f][v+1],P=u[f+1][v],p=u[f+1][v+1],b=i[f][v],N=i[f][v+1],_=i[f+1][v],g=i[f+1][v+1],U=(new SQR.Face).setPosition(d,w,P,p).setUV(b,N,_,g);s.push(U)}c.layout({aPosition:3,aNormal:3,aUV:2},r*n*6);var F=0;return s.forEach(function(a){F+=a.calculateNormal().toBuffer(c,F)}),c},SQR.Primitives.createSphere=function(a,e,r,n){var t=[],o=[],s=[];n=n||{};var u,i,a=a||50,c=Math.max(3,Math.floor(e)||8),l=Math.max(3,Math.floor(r)||6),f=0,v=2*Math.PI,S=0,m=Math.PI;for(i=0;l>=i;i++)for(u=0;c>=u;u++){var Q=u/c,R=i/l,h=-a*Math.cos(f+Q*v)*Math.sin(S+R*m),V=a*Math.cos(S+R*m),d=a*Math.sin(f+Q*v)*Math.sin(S+R*m);t.push(new SQR.V3(h,V,d)),o.push(new SQR.V2(Q,1-R))}for(i=0;l>i;i++)for(u=0;c>u;u++){var w,P=c+1,p=t[i*P+u+0],b=t[i*P+u+1],N=t[(i+1)*P+u+1],_=t[(i+1)*P+u+0],g=o[i*P+u+0],U=o[i*P+u+1],F=o[(i+1)*P+u+1],M=o[(i+1)*P+u+0];w=n.reverseNormals?(new SQR.Face).setPosition(b,p,N,_).setUV(U,g,F,M):(new SQR.Face).setPosition(p,b,_,N).setUV(g,U,M,F),n.flatShading?w.calculateNormal():(p.normal=p.clone().norm(),b.normal=b.clone().norm(),N.normal=N.clone().norm(),_.normal=_.clone().norm(),n.reverseNormals&&(p.normal.neg(),b.normal.neg(),N.normal.neg(),_.normal.neg())),s.push(w)}var B=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*s.length),y=0;return s.forEach(function(a){y+=a.toBuffer(B,y,!n.flatShading)}),B};