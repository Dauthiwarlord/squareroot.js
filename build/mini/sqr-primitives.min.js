SQR.Primitives.createPoint=function(e,a){return SQR.Buffer().layout(SQR.v2(),1).setMode(SQR.gl.POINTS).data("aPosition",e||0,a||0).update()},SQR.Primitives.createCube=function(e,a,n){e=e||1,a=a||1,n=n||1;var r=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},36),t=new SQR.V3(e*-.5,.5*a,.5*n),o=new SQR.V3(.5*e,.5*a,.5*n),s=new SQR.V3(e*-.5,a*-.5,.5*n),u=new SQR.V3(.5*e,a*-.5,.5*n),i=new SQR.V3(e*-.5,.5*a,n*-.5),c=new SQR.V3(.5*e,.5*a,n*-.5),f=new SQR.V3(e*-.5,a*-.5,n*-.5),l=new SQR.V3(.5*e,a*-.5,n*-.5),v=new SQR.V2(0,1),S=new SQR.V2(1,1),Q=new SQR.V2(0,0),m=new SQR.V2(1,0),R=[];R.push(SQR.Face().setPosition(t,o,s,u).setUV(v,S,Q,m)),R.push(SQR.Face().setPosition(c,i,l,f).setUV(v,S,Q,m)),R.push(SQR.Face().setPosition(i,t,f,s).setUV(v,S,Q,m)),R.push(SQR.Face().setPosition(o,c,u,l).setUV(v,S,Q,m)),R.push(SQR.Face().setPosition(i,c,t,o).setUV(v,S,Q,m)),R.push(SQR.Face().setPosition(s,u,f,l).setUV(v,S,Q,m));var h=0;return R.forEach(function(e){h+=e.calculateNormal().toBuffer(r,h)}),r},SQR.Primitives.createCylinder=function(e,a,n,r){r=r||{};var t,o,s,u,i,c,f=[],l=function(e,a,n,r,t,o,s,u){var i=(new SQR.Face).setPosition(e,a,n,r).setUV(t,o,s,u);f.push(i)};t=[],o=[],s=[],u=[];for(var v=0;n>v;v++){var S=new SQR.V3,Q=new SQR.V3,m=new SQR.V2,R=new SQR.V2,h=Math.cos(v/n*SQR.TWOPI)*a,V=Math.sin(v/n*SQR.TWOPI)*a;r.vertical?(S.set(V,e*-.5,h),Q.set(V,.5*e,h)):(S.set(e*-.5,h,V),Q.set(.5*e,h,V)),m.set(v/n,0),R.set(v/n,1),r.noCaps||(r.vertical?(i=new SQR.V3(0,e*-.5,0),c=new SQR.V3(0,.5*e,0)):(i=new SQR.V3(e*-.5,0,0),c=new SQR.V3(.5*e,0,0))),t.push(S),o.push(Q),s.push(m),u.push(R),r.insideFaces&&(S._inside=S.clone(),Q._inside=Q.clone())}for(var v=0;n>v;v++){var d=t[v],w=o[v],P=s[v],p=u[v],b=(v+1)%n,g=t[b],N=o[b],_=s[b],U=u[b];l(d,w,g,N,P,p,_,U),r.noCaps?r.insideFaces&&l(d._inside,g._inside,w._inside,N._inside,P,p,_,U):(l(d,g,i,null,p,U,_),l(N,w,c,null,U,p,_))}var S,F=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*f.length),M=0;return f.forEach(function(e){M+=e.calculateNormal().toBuffer(F,M)}),F},SQR.Extrude=function(){var e={};e.buffer=SQR.Buffer();var a,n,r,t,o,s,u,i=[],c=[];e.setPaths=function(o,s,u,i){return a=o,n=o.length,r=s,t=u||10,f(i),e},e.makeCaps=function(){return e};var f=function(a){i.length=0,c.length=0,a=a||SQR.v3n3();for(var r=0;t>r;r++)for(var o=0;n>o;o++){var s=new SQR.V3;i.push(s)}for(var r=0;t-1>r;r++)for(var o=0;n>o;o++){var u=r*n+o,f=n-1>o?u+1:r*n,l=(r+1)*n+o,v=n-1>o?l+1:(r+1)*n,S=(new SQR.Face).setPosition(i[u],i[v],i[f]),Q=(new SQR.Face).setPosition(i[u],i[l],i[v]);c.push(S,Q)}e.buffer.layout(a,3*c.length)},l=function(u){for(var f=0;t>f;f++)for(var l=f/(t-1),v=s+l*o,S=r.matrixAt(v),Q=0;n>Q;Q++){var m=i[f*n+Q];m.copyFrom(a[Q]),u&&u(l,m),S.transformVector(m)}for(var R=0,f=0,h=c.length;h>f;f++)R+=c[f].calculateNormal().toBuffer(e.buffer,R,!1,!0)};return e.update=function(a,n,r){return s=a||0,u=n||1,o=u-s,l(r),e.buffer.update(),e},e},SQR.Face=function(){var e={},a="aPosition",n="aNormal",r="aUV";return e.setPosition=function(a,n,r,t){return e.a=a,e.b=n,e.c=r,e.d=t,e},e.setNormal=function(a){return e.normal=a,e},e.setUV=function(a,n,r,t){return e.uva=a,e.uvb=n,e.uvc=r,e.uvd=t,e},e.setColor=function(a,n,r,t){return e.ca=a,e.cb=n,e.cc=r,e.cd=t,e},e.calculateNormal=function(){var a=SQR.V3.__tv1,n=SQR.V3.__tv2;return e.normal=new SQR.V3,a.sub(e.a,e.b),a.isZero()&&a.sub(e.a,e.d),n.sub(e.c,e.a),e.normal.cross(a,n),e},e.addNormalToVertices=function(){return e.a.addNormal(e.normal),e.b.addNormal(e.normal),e.c.addNormal(e.normal),e.d&&e.d.addNormal(e.normal),e},e.toBuffer=function(t,o,s,u){var i=o;if(t.attributes[a]&&(t.set(a,i+0,e.a).set(a,i+1,e.b).set(a,i+2,e.c),e.d&&t.set(a,i+3,e.c).set(a,i+4,e.b).set(a,i+5,e.d)),t.attributes[n]&&(e.normal||s)){var c=s,f=e.normal;u&&!c&&e.normal.norm(),t.set(n,i+0,c?e.a.normal:f).set(n,i+1,c?e.b.normal:f).set(n,i+2,c?e.c.normal:f),e.d&&t.set(n,i+3,c?e.c.normal:f).set(n,i+4,c?e.b.normal:f).set(n,i+5,c?e.d.normal:f)}return t.attributes[r]&&e.uva&&(t.set(r,i+0,e.uva).set(r,i+1,e.uvb).set(r,i+2,e.uvc),e.d&&t.set(r,i+3,e.uvc).set(r,i+4,e.uvb).set(r,i+5,e.uvd)),e.d?6:3},e},SQR.Primitives.createIcosphere=function(e,a,n){var r=[],t=[],o=[],s=0;n=n||{};var u=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],i=new SQR.V3,c=(new SQR.V3(0,1,0),new SQR.V3(0,0,1),function(e){var a,n;return i.copyFrom(e),i.norm(),a=1-(.5+Math.atan2(i.z,i.x)/SQR.TWOPI),n=1-(.5-Math.asin(i.y)/Math.PI),new SQR.V2(a,n)}),f=function(e,a,n,t,o,s){var u=c(e),i=c(a),f=c(n),l=(new SQR.Face).setPosition(e,a,n).setUV(u,i,f).setColor(t,o,s);r.push(l)},l=function(a,n){for(var r=t.length,o=0;r>o;o++){var s=t[o],u=s.__v1==a&&s.__v2==n,i=s.__v2==a&&s.__v1==n;if(u||i)return s}var c=new SQR.V3;return c.sub(a,n).mul(.5).add(c,n).norm().mul(e),c.__v1=a,c.__v2=n,t.push(c),c.normal=c.clone(),c},v=function(){o[s]={};var e=o[s];e.faces=r,e.vectors=t,r=[];for(var a=e.faces.length,n=0;a>n;n++){var i=e.faces[n],c=l(i.a,i.b),v=l(i.a,i.c),S=l(i.b,i.c),Q=u[s+1];f(i.a,c,v,i.ca,Q,Q),f(i.b,S,c,i.cb,Q,Q),f(i.c,v,S,i.cc,Q,Q),f(c,S,v,Q,Q,Q)}s++},S=e,Q=.5*(1+Math.sqrt(5))*S,m=function(a,n,r){var o=new SQR.V3(a,n,r).norm();o.normal=o.clone(),o.mul(e),t.push(o)},R=function(e,a,n){var r=u[0];f(t[e],t[n],t[a],r,r,r)};for(m(-S,Q,0),m(S,Q,0),m(-S,-Q,0),m(S,-Q,0),m(0,-S,Q),m(0,S,Q),m(0,-S,-Q),m(0,S,-Q),m(Q,0,-S),m(Q,0,S),m(-Q,0,-S),m(-Q,0,S),R(0,11,5),R(0,5,1),R(0,1,7),R(0,7,10),R(0,10,11),R(1,5,9),R(5,11,4),R(11,10,2),R(10,7,6),R(7,1,8),R(3,9,4),R(3,4,2),R(3,2,6),R(3,6,8),R(3,8,9),R(4,9,5),R(2,4,11),R(6,2,10),R(8,6,7),R(9,8,1);a-->0;)v();var Q,h=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},3*r.length),V=0;return r.forEach(function(e){n.flatShading&&e.calculateNormal(),V+=e.toBuffer(h,V,!n.flatShading)}),h},SQR.Primitives.create2DQuad=function(e,a,n,r){return SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",e,a+r,e+n,a,e+n,a+r,e+n,a,e,a+r,e,a).data("aUV",0,0,1,1,1,0,1,1,0,0,0,1).update()},SQR.Primitives.createPlane=function(e,a,n,r,t,o){var s=[],u=[],i=[],c=new SQR.Buffer,f=f||{};c.width=e,c.height=a;var e=.5*e,a=.5*a,t=t||0,o=o||0,n=n||1,r=r||1;s.length=[];var l,v,S=-e+t,Q=-a+o,m=c.width/n,R=c.height/r;for(l=0;n+1>l;l++)for(u[l]=[],i[l]=[],v=0;r+1>v;v++){var h=S+l*m,V=Q+v*R;i[l][v]=new SQR.V2(l/n,v/r),u[l][v]=f.zUp?new SQR.V3(h,V,0):new SQR.V3(h,0,V)}for(l=0;n>l;l++)for(v=0;r>v;v++){var h=S+l*m,V=Q+v*R,d=u[l][v],w=u[l][v+1],P=u[l+1][v],p=u[l+1][v+1],b=i[l][v],g=i[l][v+1],N=i[l+1][v],_=i[l+1][v+1],U=(new SQR.Face).setPosition(d,w,P,p).setUV(b,g,N,_);s.push(U)}c.layout({aPosition:3,aNormal:3,aUV:2},n*r*6);var F=0;return s.forEach(function(e){F+=e.calculateNormal().toBuffer(c,F)}),c},SQR.Primitives.createSphere=function(e,a,n,r){var t=[],o=[],s=[];r=r||{};var u,i,e=e||50,c=Math.max(3,Math.floor(a)||8),f=Math.max(3,Math.floor(n)||6),l=0,v=2*Math.PI,S=0,Q=Math.PI;for(i=0;f>=i;i++)for(u=0;c>=u;u++){var m=u/c,R=i/f,h=-e*Math.cos(l+m*v)*Math.sin(S+R*Q),V=e*Math.cos(S+R*Q),d=e*Math.sin(l+m*v)*Math.sin(S+R*Q);t.push(new SQR.V3(h,V,d)),o.push(new SQR.V2(m,1-R))}for(i=0;f>i;i++)for(u=0;c>u;u++){var w,P=c+1,p=t[i*P+u+0],b=t[i*P+u+1],g=t[(i+1)*P+u+1],N=t[(i+1)*P+u+0],_=o[i*P+u+0],U=o[i*P+u+1],F=o[(i+1)*P+u+1],M=o[(i+1)*P+u+0];w=r.reverseNormals?(new SQR.Face).setPosition(b,p,g,N).setUV(U,_,F,M):(new SQR.Face).setPosition(p,b,N,g).setUV(_,U,M,F),r.flatShading?w.calculateNormal():(p.normal=p.clone().norm(),b.normal=b.clone().norm(),g.normal=g.clone().norm(),N.normal=N.clone().norm(),r.reverseNormals&&(p.normal.neg(),b.normal.neg(),g.normal.neg(),N.normal.neg())),s.push(w)}var B=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*s.length),y=0;return s.forEach(function(e){y+=e.toBuffer(B,y,!r.flatShading)}),B};