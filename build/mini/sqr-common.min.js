SQR={TWOPI:2*Math.PI,HALFPI:.5*Math.PI,EPSILON:1e-6,gl:null,fullScreenQuad:null,shaderPath:".",Primitives:{},v2:function(){return{aPosition:2}},v3:function(){return{aPosition:3}},v2u2:function(){return{aPosition:2,aUV:2}},v2c3:function(){return{aPosition:2,aColor:3}},v3n3:function(){return{aPosition:3,aNormal:3}},v3n3u2:function(){return{aPosition:3,aNormal:3,aUV:2}},WARN_UNIFORM_NOT_PRESENT:!1},SQR.Version={version:"3",build:9,date:"2014-12-24T06:30:26.352Z"},SQR.Buffer=function(){var e,r,t,a,n={},i=!1;return n.mode=SQR.gl.TRIANGLES,n.setMode=function(e){return n.mode=e,n},n.layout=function(r,t){n.size=t,n.strideSize=0,n.layout=r,n.attributes={};for(var a in r){var i={offset:n.strideSize,byteOffset:4*n.strideSize,size:r[a]};n.strideSize+=r[a],n.attributes[a]=i}return n.strideByteSize=4*n.strideSize,e=new Float32Array(t*n.strideSize),n},n.data=function(r,t){t instanceof Array||(t=Array.prototype.slice.call(arguments,1));for(var a=n.attributes[r],i=t.length/a.size,o=0;i>o;o++)for(var u=0;u<a.size;u++)e[o*n.strideSize+u+a.offset]=t[o*a.size+u];return n},n.set=function(r,t,a){a.toArray?a=a.toArray():a instanceof Array||(a=Array.prototype.slice.call(arguments,2));for(var i=n.attributes[r],o=0;o<i.size;o++)e[t*n.strideSize+o+i.offset]=a[o];return n},n.iterate=function(r,t){for(var a=n.attributes[r],i=0,o=0;o<e.length;o+=n.strideSize)t(o+a.offset,e,i),i++;return n},n.bind=function(){return SQR.gl.bindBuffer(SQR.gl.ARRAY_BUFFER,t),n},n.update=function(){var o=SQR.gl;return t=t||o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW),i&&(a=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,a),o.bufferData(o.ELEMENT_ARRAY_BUFFER,r,o.STATIC_DRAW)),n},n.index=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments,0)),r=new Uint16Array(e),n.indexSize=e.length,i=!0,n},n.isIndexed=function(){return i},n.draw=function(){var e=SQR.gl;i?e.drawElements(n.mode,n.indexSize,e.UNSIGNED_SHORT,0):e.drawArrays(n.mode,0,n.size)},n.setRawData=function(r,t){e.set(r,t)},n.getDataArray=function(){return e},n.destroy=function(){SQR.gl.deleteBuffer(t),i&&SQR.gl.deleteBuffer(a)},n},SQR.Context=function(e){var r="> SQR.Context - Webgl is not supported.",t="> SQR.Context - Invalid canvas reference.";if(e||(e=document.createElement("canvas")),e instanceof HTMLElement||(e=document.querySelector(e)),!e.getContext)throw t;var a,n={canvas:e};return n.create=function(t,i){i=i||function(){throw r},t=t||{},void 0===t.antialias&&(t.antialias=!0),window.WebGLRenderingContext||i();try{a=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}catch(o){console.error(o),i()}return n.gl=a,n.setAsCurrent(),n},n.size=function(r,t){return e.width=r,e.height=t,a.viewport(0,0,r,t),n},n.clearColor=function(e,r,t,i){return a.clearColor(e,r,t,i),n},n.clear=function(){return a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),n},n.setAsCurrent=function(){return SQR.gl=a,n},n},SQR.Cubemap=function(e,r){var t={};t.tex=SQR.gl.createTexture();var a=6,n={};r=r||{};var i=function(){var e=SQR.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,t.tex),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.right),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.left),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.up),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.down),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.front),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.back),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),r.onLoad&&r.onLoad()},o=function(){a--,0>=a&&i()},u=function(e,r){"string"==typeof r?(n[e]=new Image,n[e].onload=o,n[e].src=r):(r instanceof Image||r.getContext)&&(n[e]=r,o())};return e.left?(u("left",e.left),u("right",e.right),u("up",e.up),u("down",e.down),u("back",e.back),u("front",e.front)):(u("left",e),u("right",e),u("up",e),u("down",e),u("back",e),u("front",e)),t},SQR.FrameBuffer=function(e,r,t,a){t=t||1;var n={},i=SQR.gl;if(n.texture=i.createTexture(),n.depthBuffer=i.createRenderbuffer(),a){i.bindTexture(i.TEXTURE_CUBE_MAP,n.texture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);for(var o=0;6>o;o++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,n.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r);var u=function(e){var r=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n.depthBuffer),i.bindFramebuffer(i.FRAMEBUFFER,null),r};n.faces={right:u(0),left:u(1),up:u(2),down:u(3),front:u(4),back:u(5)},i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null)}else n.fbo=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,n.fbo),i.bindTexture(i.TEXTURE_2D,n.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,n.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n.depthBuffer),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null);return n.bind=function(t){var a=n.faces?n.faces[t]:n.fbo;i.viewport(0,0,e,r),i.bindFramebuffer(i.FRAMEBUFFER,a)},n.resize=function(a,o){e=a*t|0,r=o*t|0,i.bindFramebuffer(i.FRAMEBUFFER,n.fbo),i.bindTexture(i.TEXTURE_2D,n.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,n.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r)},n},SQR.Loader={loadText:function(e,r){var t=new XMLHttpRequest;t.open("GET",e);var a=function(){4==t.readyState&&(t.removeEventListener("readystatechange",a),r(t.responseText,e))};t.addEventListener("readystatechange",a),t.send()},loadJSON:function(e,r){SQR.Loader.loadText(e,function(t){r(JSON.parse(t),e)})},loadImage:function(e,r){var t=new Image;if(r){var a=function(){t.removeEventListener("load",a),r(t,e)};t.addEventListener("load",a)}return t.src=e,t},loadWebcam:function(e,r){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia||(console.error("> SQR.Loader - getUserMedia not supported"),e()),r=r||{audio:!1,video:{}};var t=function(e){n.stream=e,n.src=window.URL.createObjectURL(e),n.play(),n.addEventListener("canplaythrough",a,!1)},a=function(){e(n,"webcam")},n=document.createElement("video");n.autoplay=!0,navigator.getUserMedia(r,t,function(e){console.error("> SQR.Loader - getUserMedia error ",e)})},loadVideo:function(e,r){var t=function(){r(a,e)},a=document.createElement("video");a.autoplay=!0,a.addEventListener("canplaythrough",t,!1);var n=e;a.canPlayType("video/mp4")||(n=n.replace("mp4","webm")),a.src=n},loadAssets:function(e,r,t){var a=e.length;SQR.Loader.assets={};for(var n={},i=function(i,o){SQR.Loader.assets[n[o]||o]=i,a--,t&&t(a,e.length),0==a&&r(SQR.Loader.assets)},o=0;a>o;o++){var u=e[o];"string"!=typeof u&&(n[u[0]]=u[1],u=u[0]);var f=u.substring(u.lastIndexOf(".")+1);if(u.indexOf("~")>-1){if(SQR.GLSL&&SQR.GLSL[u.substring(2)]){a--;continue}u=u.replace("~",SQR.shaderPath)}switch(f){case"glsl":SQR.Loader.loadText(u,i);break;case"png":case"jpg":case"gif":SQR.Loader.loadImage(u,i);break;case"json":case"js":SQR.Loader.loadJSON(u,i);break;case"mp4":case"webm":SQR.Loader.loadVideo(u,i);break;case"webcam":SQR.Loader.loadWebcam(i)}}}},SQR.PostEffect=function(e){SQR.fullScreenQuad=SQR.fullScreenQuad||SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",-1,1,1,1,1,-1,-1,1,1,-1,-1,-1).data("aUV",0,1,1,1,1,0,0,1,1,0,0,0).update();var r=new SQR.Transform;return r.buffer=SQR.fullScreenQuad,r.shader=SQR.Shader(e),r},SQR.Renderer=function(e){var r,t,a={},n=[],i=[],o=function(e){if(e.active){if(e.transformWorld(),e.numChildren>0)for(var r=0;r<e.numChildren;r++)o(e.children[r]);e.buffer&&e.shader&&(e.transparent?i.push(e):n.push(e))}},u={};return a.render=function(f,E,c){var l=SQR.gl;c=c||u,c.dontClear||e.clear(),l.disable(l.BLEND),l.enable(l.DEPTH_TEST),l.enable(l.CULL_FACE),l.frontFace(l.CW),n.length=0,i.length=0,o(f),E&&E.computeInverseMatrix(),n=n.concat(i);var s,R=n.length,d=null,T=null,m=!1,S=c&&c.replacementShader;S&&(T=c.replacementShader.use());for(var _=0;R>_;_++){r=!1,t=!1;var s=n[_];if(s.transformView(E?E.inverseWorldMatrix:null),s.transparent&&(m||(l.enable(l.BLEND),m=!0),l.blendFunc(s.srcFactor,s.dstFactor)),d!=s.buffer&&(d=s.buffer,d.bind(),t=!0),T!=s.shader&&!S){T=s.shader.use().updateTextures();var A=E&&E.projection||a.projection;if(!A)throw"No projection defined on camera and no default projection on renderer.";T.setUniform("uProjection",A),r=!0}(r||t)&&T.attribPointers(d),s.draw(c)}},a.renderToScreen=function(){var e=SQR.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},a},SQR.Shader=function(e,r){var t,a={},n={},i=[],o={},u=[],f=[],E=function(e){if(!e)throw"> SQR.Shader.parseGLSL - Shader source code missing";for(var r="",t="",a=!0,n=e.split("\n"),i=0;i<n.length;i++){var o=n[i];if(o.indexOf("//#include")>-1){var u,f=o.substring(11);if(u=SQR.GLSL&&SQR.GLSL[f.substring(1)]?SQR.GLSL[f.substring(1)]:SQR.Loader.assets[f.replace("~",SQR.shaderPath)],!u)throw"> SQR.Shader.parseGLSL - Include not found "+f;n[i]=u}}for(var n=n.join("\n").split("\n"),i=0;i<n.length;i++){var o=n[i];if(o.indexOf("//#")>-1)o.indexOf("//#fragment")>-1?a=!1:o.indexOf("//#vertex")>-1&&(a=!0);else{if(o.indexOf("//")>-1&&(o=o.substring(0,o.indexOf("//"))),o.match(/^([\s\t]*)$/))continue;a?r+=o+"\n":t+=o+"\n"}}return{vertex:r,fragment:t}};a.compile=function(){var r=e=E(e),n=SQR.gl,i=n.createShader(n.VERTEX_SHADER);n.shaderSource(i,r.vertex),n.compileShader(i);var o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(o,r.fragment),n.compileShader(o),t=n.createProgram(),n.attachShader(t,i),n.attachShader(t,o),n.linkProgram(t),!n.getShaderParameter(i,n.COMPILE_STATUS))throw"> SQR.Shader. Vertex shader compile error: "+n.getShaderInfoLog(i);if(!n.getShaderParameter(o,n.COMPILE_STATUS))throw"> SQR.Shader. Fragment shader compile error: "+n.getShaderInfoLog(o);if(!n.getProgramParameter(t,n.LINK_STATUS))throw"> SQR.Shader. Shader linking error: "+n.getProgramInfoLog(t);return a},a.inspect=function(){for(var e=SQR.gl,r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),E=0;r>E;E++){var c=e.getActiveAttrib(t,E);c.location=e.getAttribLocation(t,c.name),n[c.name]=c,i.push(c)}for(var l=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0,E=0;l>E;E++){var R=e.getActiveUniform(t,E);R.location=e.getUniformLocation(t,R.name),(R.type==e.SAMPLER_2D||R.type==e.SAMPLER_CUBE)&&(R.texId=s++,f.push(R)),o[R.name]=R,u.push(R)}return a};var c="string";a.getUniform=function(e){return o[e]},a.hasUniform=function(e){return null!=o[e]},a.setUniform=function(e,r){var t=SQR.gl,n=typeof e==c?o[e]:e,i=r;if(!n)return SQR.WARN_UNIFORM_NOT_PRESENT&&(console.warn("> SQR.Shader attempt to set uniform that does not exist: "+e),console.trace()),a;switch(i.toUniform&&(i=i.toUniform(n.type)),n.type){case t.BYTE:t.uniform1i(n.location,i);break;case t.UNSIGNED_BYTE:t.uniform1i(n.location,i);break;case t.SHORT:t.uniform1i(n.location,i);break;case t.UNSIGNED_SHORT:t.uniform1i(n.location,i);break;case t.INT:t.uniform1i(n.location,i);break;case t.INT_VEC2:t.uniform2iv(n.location,i);break;case t.INT_VEC3:t.uniform3iv(n.location,i);break;case t.INT_VEC4:t.uniform4iv(n.location,i);break;case t.UNSIGNED_INT:t.uniform1i(n.location,i);break;case t.FLOAT:t.uniform1f(n.location,i);break;case t.FLOAT_VEC2:t.uniform2fv(n.location,i);break;case t.FLOAT_VEC3:t.uniform3fv(n.location,i);break;case t.FLOAT_VEC4:t.uniform4fv(n.location,i);break;case t.BOOL:t.uniform1i(n.location,i);break;case t.BOOL_VEC2:t.uniform2iv(n.location,i);break;case t.BOOL_VEC3:t.uniform3iv(n.location,i);break;case t.BOOL_VEC4:t.uniform4iv(n.location,i);break;case t.FLOAT_MAT2:t.uniformMatrix2fv(n.location,!1,i.data||i);break;case t.FLOAT_MAT3:t.uniformMatrix3fv(n.location,!1,i.data||i);break;case t.FLOAT_MAT4:t.uniformMatrix4fv(n.location,!1,i.data||i);break;case t.SAMPLER_2D:l(n,i);break;case t.SAMPLER_CUBE:s(n,i);break;default:console.warn("> SQR.Shader > WARNING! Unknown uniform type ( 0x"+n.type.toString(16)+" )")}return a};var l=function(e,r){var t=SQR.gl,a=e.texId;e.texref=r,t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,r.tex||r),r.isAnimated&&r.update(),t.uniform1i(e.location,a)},s=function(e,r){var t=SQR.gl,a=e.texId;e.texref=r,t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_CUBE_MAP,r.tex||r),t.uniform1i(e.location,a)};return a.updateTextures=function(){for(var e=(SQR.gl,0),r=f.length;r>e;e++){var t=f[e];t.texref&&a.setUniform(t,t.texref)}return a},a.use=function(){return SQR.gl.useProgram(t),a},a.attribPointers=function(e){var r=SQR.gl,t=i.length;e=e.buffer||e;for(var n=0;t>n;n++){var o=i[n],u=e.attributes[o.name];if(!u)throw"> SQR.Shader expects attribute "+o.name+" but geometry doesn't provide it";o.enabled||r.enableVertexAttribArray(o.location),r.vertexAttribPointer(o.location,u.size,r.FLOAT,!1,e.strideByteSize,u.byteOffset),o.enabled=!0}return a},r&&r.doNotCompile||(a.compile(),a.inspect()),a},SQR.Texture=function(e,r){if(r=r||{},!(e instanceof HTMLVideoElement||e instanceof Image||e instanceof HTMLCanvasElement))throw console.error("Invalid source: "+e),"SQR.Texture > provided source is not a valid source for texture";var t={},a=SQR.gl,n=e,i=a.createTexture();t.isAnimated=r&&r.isAnimated||e instanceof HTMLVideoElement;var o=function(){var e=n.width,r=n.height;return e>0&&r>0&&0==(e&e-1)&&0==(r&r-1)};t.update=function(){var e=SQR.gl;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),t};var u=r.wrapS||r.wrap||a.CLAMP_TO_EDGE,f=r.wrapT||r.wrap||a.CLAMP_TO_EDGE;a.bindTexture(a.TEXTURE_2D,i),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,n);var E,c;return o()?(a.generateMipmap(a.TEXTURE_2D),E=a.LINEAR_MIPMAP_LINEAR,c=a.LINEAR):E=c=a.LINEAR,a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,E),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,u),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,f),a.bindTexture(a.TEXTURE_2D,null),t.tex=i,t},SQR.Transform=function(e){var r={};r.name=e||"sqr.transform."+SQR.TransformCount++,r.active=!0,r.position=new SQR.V3,r.globalPosition=new SQR.V3,r.quaternion=new SQR.Quaternion,r.rotation=new SQR.V3,r.scale=new SQR.V3(1,1,1),r.useQuaternion=!1,r.isStatic=!1,r.directMatrixMode=!1;var t=0;return r.matrix=new SQR.Matrix44,r.normalMatrix=new SQR.Matrix33,r.globalMatrix=new SQR.Matrix44,r.viewMatrix=new SQR.Matrix44,r.inverseWorldMatrix,r.lookAt=null,r.transparent=!1,r.srcFactor=null,r.dstFactor=null,r.setBlending=function(e,t,a){r.transparent=e,r.srcFactor=t||SQR.gl.SRC_ALPHA,r.dstFactor=a||SQR.gl.ONE_MINUS_SRC_ALPHA},r.children=[],r.numChildren=0,r.add=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t.parent=r,-1==r.children.indexOf(t)&&r.children.push(t)}return r.numChildren=r.children.length,r},r.remove=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],a=r.children.indexOf(t);if(-1==a)return!1;t.parent=null,r.children.splice(a,1)}return r.numChildren=r.children.length,r},r.removeAll=function(){r.children.length=0,r.numChildren=0},r.contains=function(e){return r.children.indexOf(e)>-1},r.recurse=function(e,t){t||e(r);for(var a=0;a<r.numChildren;a++)r.children[a].recurse(e)},r.draw=function(e){var t=e&&e.replacementShader,a=t?e.replacementShader:r.shader;if(a.setUniform("uMatrix",r.globalMatrix),a.setUniform("uViewMatrix",r.viewMatrix),a.setUniform("uNormalMatrix",r.normalMatrix),!t&&a.uniforms)for(var n=Object.keys(a.uniforms),i=0,o=n.length;o>i;i++)a.setUniform(n[i],a.uniforms[n[i]]);if(!t&&r.uniforms)for(var n=Object.keys(r.uniforms),i=0,o=n.length;o>i;i++)a.setUniform(n[i],r.uniforms[n[i]]);r.buffer.draw()},r.transformWorld=function(){if(1!=t){if(!r.directMatrixMode){var e=r.position,a=r.scale;if(r.useQuaternion){var n=r.quaternion;r.matrix.setTQS(e.x,e.y,e.z,n.w,n.x,n.y,n.z,a.x,a.y,a.z)}else{var i=r.rotation;r.matrix.setTRS(e.x,e.y,e.z,i.x,i.y,i.z,a.x,a.y,a.z)}}r.lookAt&&r.matrix.lookAt(r.lookAt.position),r.parent?(r.parent.globalMatrix.copyTo(r.globalMatrix),r.globalMatrix.multiply(r.matrix)):r.matrix.copyTo(r.globalMatrix),r.globalMatrix.extractPosition(r.globalPosition),r.isStatic&&(t=1)}},r.viewDepth=function(){return r.viewMatrix.data[14]},r.transformView=function(e){e?(e.copyTo(r.viewMatrix),r.viewMatrix.multiply(r.globalMatrix),r.viewMatrix.inverseMat3(r.normalMatrix)):(r.globalMatrix.copyTo(r.viewMatrix),r.viewMatrix.inverseMat3(r.normalMatrix))},r.computeInverseMatrix=function(){return r.inverseWorldMatrix||(r.inverseWorldMatrix=new SQR.Matrix44),r.globalMatrix.inverse(r.inverseWorldMatrix),r.inverseWorldMatrix},r},SQR.TransformCount=0;